<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>YardSale: ys_database.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>ys_database.cpp</h1><div class="fragment"><pre>00001 <span class="preprocessor">#include &lt;string&gt;</span>
00002 <span class="preprocessor">#include &lt;sstream&gt;</span>
00003 <span class="preprocessor">#include &lt;memory&gt;</span>
00004 
00005 <span class="preprocessor">#include "ys_log.h"</span>
00006 <span class="preprocessor">#include "ys_exception.h"</span>
00007 <span class="preprocessor">#include "ys_database.h"</span>
00008 
00009 <span class="preprocessor">#include "ys_group.h"</span>
00010 <span class="preprocessor">#include "ys_inv_type.h"</span>
00011 <span class="preprocessor">#include "ys_trans_type.h"</span>
00012 <span class="preprocessor">#include "ys_employee_type.h"</span>
00013 <span class="preprocessor">#include "ys_cust_type.h"</span>
00014 <span class="preprocessor">#include "ys_vend_type.h"</span>
00015 <span class="preprocessor">#include "ys_trans_type.h"</span>
00016 <span class="preprocessor">#include "ys_package_type.h"</span>
00017 <span class="preprocessor">#include "ys_date.h"</span>
00018 
00019 <span class="preprocessor">#define OTL_ODBC_MYSQL</span>
00020 <span class="preprocessor"></span><span class="preprocessor">#define OTL_STL</span>
00021 <span class="preprocessor"></span>
00022 <span class="preprocessor">#ifndef WIN32</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#define OTL_ODBC_UNIX</span>
00024 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#define OTL_ODBC</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00027 <span class="preprocessor"></span>
00028 <span class="preprocessor">#include &lt;otlv4.h&gt;</span>
00029 
00030 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00031 <span class="comment">//using namespace odbc;</span>
00032 
<a name="l00033"></a><a class="code" href="class_yard_database.html#a0">00033</a> <a class="code" href="class_yard_database.html#a1">YardDatabase::YardDatabase</a>(<span class="keyword">const</span> string&amp; name, <span class="keyword">const</span> string&amp; pass, <span class="keyword">const</span> string&amp; dsn) {
00034     m_db = 0;
00035     <a class="code" href="class_yard_database.html#a2">Init</a>(dsn, name, pass);
00036 }
00037   
<a name="l00038"></a><a class="code" href="class_yard_database.html#a1">00038</a> <a class="code" href="class_yard_database.html#a1">YardDatabase::YardDatabase</a>() {
00039     m_db = 0;
00040 }
00041 
<a name="l00042"></a><a class="code" href="class_yard_database.html#a3">00042</a> <a class="code" href="class_yard_database.html#a3">YardDatabase::~YardDatabase</a>() 
00043 {
00044     <span class="keyword">delete</span> m_db;
00045   
00046 }
00047 
00048 <span class="keywordtype">bool</span> YardDatabase::IsConnected()<span class="keyword"> const </span>
00049 <span class="keyword"></span>{
00050     <span class="keywordflow">if</span> (!m_db)
00051         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00052     
00053     <span class="keywordflow">if</span> (m_db-&gt;connected != 0)
00054         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00055     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00056     
00057 }
00058 
<a name="l00059"></a><a class="code" href="class_yard_database.html#a2">00059</a> <span class="keywordtype">bool</span> <a class="code" href="class_yard_database.html#a2">YardDatabase::Init</a>(<span class="keyword">const</span> string&amp; name, <span class="keyword">const</span> string&amp; pass, <span class="keyword">const</span> string&amp; dsn)
00060 {
00061     <span class="keywordflow">if</span> (m_db)
00062         <span class="keyword">delete</span> m_db;
00063     
00064     m_db = <span class="keyword">new</span> otl_connect();
00065     otl_connect::otl_initialize();
00066     
00067     m_dsn = dsn;
00068     m_name = name;
00069     m_pass = pass;
00070     
00071     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00072 }
00073    
00074 
<a name="l00075"></a><a class="code" href="class_yard_database.html#a6">00075</a> <span class="keywordtype">int</span> <a class="code" href="class_yard_database.html#a6">YardDatabase::GetStatus</a>()<span class="keyword"> const </span>{
00076        
00077     <span class="keywordflow">return</span> -1;
00078 }
00079 
<a name="l00080"></a><a class="code" href="class_yard_database.html#a4">00080</a> <span class="keywordtype">bool</span> <a class="code" href="class_yard_database.html#a4">YardDatabase::connect</a>(){
00081     
00082     <span class="keywordflow">if</span> (!m_db)
00083         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00084 
00085     stringstream loginString;
00086     loginString &lt;&lt; <span class="stringliteral">"UID="</span> &lt;&lt; m_name &lt;&lt; <span class="stringliteral">";PWD="</span> &lt;&lt; m_pass 
00087         &lt;&lt; <span class="stringliteral">";DSN="</span> &lt;&lt; m_dsn;
00088         
00089     <span class="keywordflow">try</span> {     
00090         m_db-&gt;rlogon(loginString.str().c_str()); <span class="comment">// connect to ODBC </span>
00091     } <span class="keywordflow">catch</span>(otl_exception &amp;e) {
00092         
00093         <span class="keywordflow">try</span>{ m_db-&gt;logoff(); } <span class="keywordflow">catch</span>(otl_connect&amp;){}
00094         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg);
00095         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00096     }        
00097 
00098     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00099 }
00100 
<a name="l00101"></a><a class="code" href="class_yard_database.html#a5">00101</a> <span class="keywordtype">bool</span> <a class="code" href="class_yard_database.html#a5">YardDatabase::disconnect</a>()
00102 {
00103     <span class="keywordflow">if</span> (!m_db)
00104     {   
00105         wxLogError(wxT(<span class="stringliteral">"DB not allocated in disconnect()"</span>));
00106         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00107     }
00108     
00109     <span class="keywordflow">try</span> {
00110         m_db-&gt;logoff();
00111     }
00112     <span class="keywordflow">catch</span>( otl_exception &amp;e) {
00113         
00114         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00115         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00116     }
00117     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00118 }
00119 
<a name="l00120"></a><a class="code" href="class_yard_database.html#a8">00120</a> vector&lt;YardInvType&gt; <a class="code" href="class_yard_database.html#a8">YardDatabase::InventorySearchSKU</a>(<span class="keyword">const</span> string&amp; sku) {
00121    
00122     <span class="keywordflow">if</span> (!m_db)
00123         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00124     
00125     stringstream sql;
00126     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Inventory_Table WHERE INV_SKU_Number = '"</span> &lt;&lt; sku &lt;&lt; <span class="stringliteral">"'"</span>;
00127     
00128     auto_ptr&lt;otl_stream&gt; dbStream;
00129     
00130     <span class="keywordflow">try</span> {
00131         dbStream.reset( <span class="keyword">new</span> otl_stream(50, sql.str().c_str(), *m_db) );
00132     
00133     } <span class="keywordflow">catch</span> (otl_exception &amp;e) {
00134         
00135         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00136     }
00137         
00138     <span class="keywordflow">return</span> XMLFromStream&lt;YardInvType&gt;(dbStream.get(), <span class="stringliteral">"Inventory_Table"</span>);
00139 }
00140 
<a name="l00141"></a><a class="code" href="class_yard_database.html#a25">00141</a> vector&lt;YardEmployeeType&gt; <a class="code" href="class_yard_database.html#a25">YardDatabase::EmployeeGetAll</a>()<span class="keyword"> const</span>{
00142     
00143     <span class="keywordflow">if</span> (!m_db)
00144         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00145     
00146     stringstream sql;
00147     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Employee_Table"</span>;
00148     
00149     auto_ptr&lt;otl_stream&gt; dbStream;
00150 
00151     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc</span>
00152         dbStream.reset( <span class="keyword">new</span> otl_stream(50, sql.str().c_str(), *m_db) );
00153     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00154         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00155     }
00156     <span class="keywordflow">return</span> XMLFromStream&lt;YardEmployeeType&gt;(dbStream.get(), <span class="stringliteral">"Employee_Table"</span>);
00157 }
00158 
00159 
<a name="l00160"></a><a class="code" href="class_yard_database.html#a45">00160</a> map&lt;string,string&gt; <a class="code" href="class_yard_database.html#a45">YardDatabase::ACLGetAll</a>()<span class="keyword"> const</span>
00161 <span class="keyword"></span>{
00162     <span class="keywordflow">if</span> (!m_db)
00163         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00164     
00165     stringstream sql;
00166     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM ACL_Table"</span>;
00167     
00168     auto_ptr&lt;otl_stream&gt; dbStream;
00169 
00170     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00171         dbStream.reset( <span class="keyword">new</span> otl_stream(5, sql.str().c_str(), *m_db) );
00172     
00173     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00174         
00175         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00176     }
00177     
00178     map&lt;string, string&gt; acls;
00179     
00180     <span class="keywordflow">try</span> {
00181         string name, desc;
00182         <span class="keywordflow">while</span>(!dbStream-&gt;eof())
00183         {    
00184             *dbStream &gt;&gt; name &gt;&gt; desc;
00185             acls[name] = desc;
00186         }
00187     }<span class="keywordflow">catch</span> (otl_exception&amp; e) {
00188         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00189     }
00190         
00191     <span class="keywordflow">return</span> acls;
00192     
00193 }
00194 <span class="keywordtype">void</span> YardDatabase::ACLAdd(<span class="keyword">const</span> string&amp; name, <span class="keyword">const</span> string&amp; desc)
00195 {
00196     <span class="keywordflow">if</span> (!m_db)
00197         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00198     
00199     stringstream sql;
00200     sql &lt;&lt; <span class="stringliteral">"INSERT INTO ACL_Table values('"</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">"','"</span> 
00201         &lt;&lt; desc &lt;&lt; <span class="stringliteral">"');"</span>;
00202     
00203     wxLogDebug(sql.str().c_str());
00204     auto_ptr&lt;otl_stream&gt; dbStream;
00205 
00206     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00207         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00208     
00209     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00210         
00211         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00212     }
00213 }
00214 
00215 string YardDatabase::ACLGet(<span class="keyword">const</span> string&amp; name)
00216 {
00217     <span class="keywordflow">if</span> (!m_db)
00218         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00219     
00220     stringstream sql;
00221     sql &lt;&lt; <span class="stringliteral">"SELECT ACL_Description FROM ACL_Table where ACL_Type = '"</span>
00222         &lt;&lt; name &lt;&lt; <span class="stringliteral">"';"</span>;
00223     
00224     auto_ptr&lt;otl_stream&gt; dbStream;
00225 
00226     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00227         dbStream.reset( <span class="keyword">new</span> otl_stream(5, sql.str().c_str(), *m_db) );
00228     
00229     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00230         
00231         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00232     }
00233     string desc;
00234     <span class="keywordflow">try</span> {
00235         *dbStream &gt;&gt; desc;
00236         
00237     }<span class="keywordflow">catch</span> (otl_exception&amp; e) {
00238         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00239     }
00240     <span class="keywordflow">return</span> desc;
00241 }
00242 
<a name="l00243"></a><a class="code" href="class_yard_database.html#a10">00243</a> vector&lt;YardInvType&gt; <a class="code" href="class_yard_database.html#a10">YardDatabase::InventoryGetAll</a>()<span class="keyword"> const</span>{
00244     
00245     <span class="keywordflow">if</span> (!m_db)
00246         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00247     
00248     stringstream sql;
00249     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Inventory_Table"</span>;
00250     
00251     auto_ptr&lt;otl_stream&gt; dbStream;
00252 
00253     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00254         dbStream.reset( <span class="keyword">new</span> otl_stream(50, sql.str().c_str(), *m_db) );
00255     
00256     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00257         
00258         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00259     }
00260         
00261     <span class="keywordflow">return</span> XMLFromStream&lt;YardInvType&gt;(dbStream.get(), <span class="stringliteral">"Inventory_Table"</span>);
00262 }
00263 
<a name="l00264"></a><a class="code" href="class_yard_database.html#a29">00264</a> vector&lt;YardCarrierType&gt; <a class="code" href="class_yard_database.html#a29">YardDatabase::CarrierGetAll</a>()<span class="keyword"> const</span>{
00265     
00266     <span class="keywordflow">if</span> (!m_db)
00267         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00268     
00269     stringstream sql;
00270     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Carrier_Table"</span>;
00271     
00272     auto_ptr&lt;otl_stream&gt; dbStream;
00273 
00274     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00275         dbStream.reset( <span class="keyword">new</span> otl_stream(50, sql.str().c_str(), *m_db) );
00276     
00277     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00278         
00279         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00280     }
00281         
00282     <span class="keywordflow">return</span> XMLFromStream&lt;YardCarrierType&gt;(dbStream.get(), <span class="stringliteral">"Carrier_Table"</span>);
00283 }
00284 
<a name="l00285"></a><a class="code" href="class_yard_database.html#a26">00285</a> vector&lt;YardVendType&gt; <a class="code" href="class_yard_database.html#a26">YardDatabase::VendorGetAll</a>()<span class="keyword"> const</span>{
00286     
00287     <span class="keywordflow">if</span> (!m_db)
00288         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00289     
00290     stringstream sql;
00291     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Vendor_Table"</span>;
00292     
00293     auto_ptr&lt;otl_stream&gt; dbStream;
00294 
00295     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00296         dbStream.reset( <span class="keyword">new</span> otl_stream(50, sql.str().c_str(), *m_db) );
00297     
00298     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00299         
00300         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00301     }
00302         
00303     <span class="keywordflow">return</span> XMLFromStream&lt;YardVendType&gt;(dbStream.get(), <span class="stringliteral">"Vendor_Table"</span>);
00304 }
00305 
00306 
<a name="l00307"></a><a class="code" href="class_yard_database.html#a38">00307</a> vector&lt;YardTaxType&gt; <a class="code" href="class_yard_database.html#a38">YardDatabase::TaxTypeGetAll</a>()<span class="keyword"> const</span>{
00308     
00309     <span class="keywordflow">if</span> (!m_db)
00310         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00311     
00312     stringstream sql;
00313     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Tax_Table"</span>;
00314     
00315     auto_ptr&lt;otl_stream&gt; dbStream;
00316 
00317     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00318         dbStream.reset( <span class="keyword">new</span> otl_stream(50, sql.str().c_str(), *m_db) );
00319     
00320     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00321         
00322         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00323     }
00324         
00325     <span class="keywordflow">return</span> XMLFromStream&lt;YardTaxType&gt;(dbStream.get(), <span class="stringliteral">"Tax_Table"</span>);
00326 }
00327 
<a name="l00328"></a><a class="code" href="class_yard_database.html#a11">00328</a> vector&lt;YardInvType&gt; <a class="code" href="class_yard_database.html#a11">YardDatabase::InventoryGetInGroup</a>(<span class="keywordtype">long</span> groupid)<span class="keyword"> const</span>
00329 <span class="keyword"></span>{
00330     <span class="keywordflow">if</span> (!m_db)
00331         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00332     
00333     stringstream sql;
00334     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Inventory_Table where INV_REF_INVGRP_Group_ID = "</span>
00335         &lt;&lt; groupid &lt;&lt; <span class="stringliteral">";"</span>;
00336     
00337     auto_ptr&lt;otl_stream&gt; dbStream;
00338 
00339     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00340         dbStream.reset( <span class="keyword">new</span> otl_stream(50, sql.str().c_str(), *m_db) );
00341     
00342     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00343         
00344         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00345     }
00346         
00347     <span class="keywordflow">return</span> XMLFromStream&lt;YardInvType&gt;(dbStream.get(), <span class="stringliteral">"Inventory_Table"</span>);
00348 }
00349 
00350 
<a name="l00351"></a><a class="code" href="class_yard_database.html#a9">00351</a> <a class="code" href="class_yard_inv_type.html">YardInvType</a> <a class="code" href="class_yard_database.html#a9">YardDatabase::InventoryBarcode</a>(<span class="keyword">const</span> string&amp; barcode)<span class="keyword"> const</span>
00352 <span class="keyword"></span>{
00353     <span class="keywordflow">if</span> (!m_db)
00354         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00355     
00356     stringstream sql;
00357     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Inventory_Table where INV_Bar_Code_Number = '"</span>
00358         &lt;&lt; barcode &lt;&lt; <span class="stringliteral">"';"</span>;
00359     wxLogDebug(sql.str().c_str());
00360     auto_ptr&lt;otl_stream&gt; dbStream;
00361 
00362     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00363         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00364     
00365     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00366         
00367         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00368     }
00369     
00371     <span class="keywordflow">if</span> (dbStream-&gt;eof())
00372         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"Stream was empty."</span>);
00373         
00374     <span class="keywordflow">return</span> XMLFromStreamSingle&lt;YardInvType&gt;(dbStream.get(), <span class="stringliteral">"Inventory_Table"</span>);   
00375 }
00376 
<a name="l00377"></a><a class="code" href="class_yard_database.html#a23">00377</a> <a class="code" href="class_yard_employee_type.html">YardEmployeeType</a> <a class="code" href="class_yard_database.html#a23">YardDatabase::EmployeeGet</a>(<span class="keywordtype">long</span> key)<span class="keyword"> const</span>
00378 <span class="keyword"></span>{
00379     <span class="keywordflow">if</span> (!m_db)
00380         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00381     
00382     stringstream sql;
00383     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Employee_Table where EMP_ID_Number = "</span>
00384         &lt;&lt; key &lt;&lt; <span class="stringliteral">";"</span>;
00385     wxLogDebug(sql.str().c_str());
00386     auto_ptr&lt;otl_stream&gt; dbStream;
00387 
00388     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00389         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00390     
00391     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00392         
00393         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00394     }
00395         
00396     <span class="keywordflow">return</span> XMLFromStreamSingle&lt;YardEmployeeType&gt;(dbStream.get(), <span class="stringliteral">"Employee_Table"</span>);   
00397 }
00398 
00399 <a class="code" href="class_yard_vend_type.html">YardVendType</a> YardDatabase::VendorGet(<span class="keywordtype">long</span> key)<span class="keyword"> const</span>
00400 <span class="keyword"></span>{
00401     <span class="keywordflow">if</span> (!m_db)
00402         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00403     
00404     stringstream sql;
00405     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Vendor_Table where VND_ID = "</span>
00406         &lt;&lt; key &lt;&lt; <span class="stringliteral">";"</span>;
00407     wxLogDebug(sql.str().c_str());
00408     auto_ptr&lt;otl_stream&gt; dbStream;
00409 
00410     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00411         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00412     
00413     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00414         
00415         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00416     }
00417         
00418     <span class="keywordflow">return</span> XMLFromStreamSingle&lt;YardVendType&gt;(dbStream.get(), <span class="stringliteral">"Vendor_Table"</span>);   
00419 }
00420 
<a name="l00421"></a><a class="code" href="class_yard_database.html#a48">00421</a> string <a class="code" href="class_yard_database.html#a48">YardDatabase::ReportXML</a>(<span class="keyword">const</span> string&amp; sql, <span class="keywordtype">long</span>&amp; count)<span class="keyword"> const</span>
00422 <span class="keyword"></span>{    
00423     <span class="keywordflow">if</span> (!m_db)
00424         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00425     
00426     wxLogDebug(sql.c_str());
00427     auto_ptr&lt;otl_stream&gt; dbStream;
00428 
00429     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00430         dbStream.reset( <span class="keyword">new</span> otl_stream(40, sql.c_str(), *m_db) );
00431     
00432     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00433         
00434         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00435     }
00436     
00437     string result;
00438     <span class="keywordflow">while</span> (!dbStream-&gt;eof())
00439     {
00440         result += string(<a class="code" href="class_yard_database.html#a51">ToXML</a>(dbStream.get(), <span class="stringliteral">"record"</span>));
00441     }        
00442     count = dbStream-&gt;get_rpc();
00443     
00444     <span class="keywordflow">return</span> result;    
00445 }
00446 
<a name="l00447"></a><a class="code" href="class_yard_database.html#a12">00447</a> <a class="code" href="class_yard_inv_type.html">YardInvType</a> <a class="code" href="class_yard_database.html#a12">YardDatabase::InventoryGet</a>(<span class="keywordtype">long</span> key)<span class="keyword"> const</span>
00448 <span class="keyword"></span>{
00449     <span class="keywordflow">if</span> (!m_db)
00450         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00451     
00452     stringstream sql;
00453     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Inventory_Table where INV_Item_ID = "</span>
00454         &lt;&lt; key &lt;&lt; <span class="stringliteral">";"</span>;
00455     wxLogDebug(sql.str().c_str());
00456     auto_ptr&lt;otl_stream&gt; dbStream;
00457 
00458     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00459         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00460     
00461     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00462         
00463         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00464     }
00465         
00466     <span class="keywordflow">return</span> XMLFromStreamSingle&lt;YardInvType&gt;(dbStream.get(), <span class="stringliteral">"Inventory_Table"</span>);
00467 }
00468 
00469 <span class="keywordtype">long</span> YardDatabase::CarrierAdd(<span class="keyword">const</span> <a class="code" href="class_yard_carrier_type.html">YardCarrierType</a>&amp; carrier)
00470 {
00471     <span class="keywordflow">if</span> (!m_db)
00472         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00473     
00474     stringstream sql;
00475     sql &lt;&lt; <span class="stringliteral">"INSERT INTO Carrier_Table values("</span> &lt;&lt; carrier.<a class="code" href="class_yard_carrier_type.html#a11">ToString</a>() &lt;&lt; <span class="stringliteral">");"</span>;
00476     
00477     wxLogDebug(sql.str().c_str());
00478     auto_ptr&lt;otl_stream&gt; dbStream;
00479 
00480     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00481         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00482     
00483     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions    </span>
00484         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00485     }
00486     
00487     <span class="comment">// This function also does a select to return the key</span>
00488     
00489     stringstream select;
00490     select &lt;&lt; <span class="stringliteral">"SELECT CRR_ID from Carrier_Table where CRR_Name = '"</span>
00491         &lt;&lt; carrier.<a class="code" href="class_yard_carrier_type.html#a5">GetName</a>() &lt;&lt; <span class="stringliteral">"';"</span>;
00492     
00493     auto_ptr&lt;otl_stream&gt; db;
00494     
00495     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00496         db.reset( <span class="keyword">new</span> otl_stream(1, select.str().c_str(), *m_db) );
00497     
00498     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00499         
00500         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00501     }
00502     
00503     <span class="keywordtype">long</span> <span class="keywordtype">int</span> key = 0;
00504     
00505     <span class="keywordflow">try</span> {
00506         *db &gt;&gt; key;
00507     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00508         
00509         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00510     }
00511     <span class="keywordflow">return</span> key;
00512     
00513 }
00514 
<a name="l00515"></a><a class="code" href="class_yard_database.html#a21">00515</a> <span class="keywordtype">long</span> <a class="code" href="class_yard_database.html#a21">YardDatabase::EmployeeAdd</a>(<span class="keyword">const</span> <a class="code" href="class_yard_employee_type.html">YardEmployeeType</a>&amp; emp)
00516 {
00517     <span class="keywordflow">if</span> (!m_db)
00518         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00519     
00520     stringstream sql;
00521     sql &lt;&lt; <span class="stringliteral">"INSERT INTO Employee_Table values("</span> &lt;&lt; emp.<a class="code" href="class_yard_employee_type.html#a3">ToString</a>() &lt;&lt; <span class="stringliteral">");"</span>;
00522     
00523     wxLogDebug(sql.str().c_str());
00524     auto_ptr&lt;otl_stream&gt; dbStream;
00525 
00526     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00527         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00528     
00529     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00530         
00531         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00532     }
00533     
00534     <span class="comment">// This function also does a select to return the key</span>
00535     
00536     stringstream select;
00537     select &lt;&lt; <span class="stringliteral">"SELECT EMP_ID_Number from Employee_Table where EMP_Social_Security_Number = "</span>
00538         &lt;&lt; emp.<a class="code" href="class_yard_employee_type.html#a8">GetTaxId</a>() &lt;&lt; <span class="stringliteral">";"</span>;
00539     
00540     auto_ptr&lt;otl_stream&gt; db;
00541     
00542     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00543         db.reset( <span class="keyword">new</span> otl_stream(1, select.str().c_str(), *m_db) );
00544     
00545     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00546         
00547         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00548     }
00549     
00550     <span class="keywordtype">long</span> <span class="keywordtype">int</span> key = 0;
00551     
00552     <span class="keywordflow">try</span> {
00553         *db &gt;&gt; key;
00554     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00555         
00556         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00557     }
00558     <span class="keywordflow">return</span> key;
00559 }
00560 
00561 
<a name="l00562"></a><a class="code" href="class_yard_database.html#a14">00562</a> <span class="keywordtype">long</span> <a class="code" href="class_yard_database.html#a14">YardDatabase::InventoryAdd</a>(<span class="keyword">const</span> <a class="code" href="class_yard_inv_type.html">YardInvType</a>&amp; item)
00563 {
00564     <span class="keywordflow">if</span> (!m_db)
00565         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00566     
00567     stringstream sql;
00568     sql &lt;&lt; <span class="stringliteral">"INSERT INTO Inventory_Table values("</span> &lt;&lt; item.<a class="code" href="class_yard_inv_type.html#a60">ToString</a>() &lt;&lt; <span class="stringliteral">");"</span>;
00569     
00570     wxLogDebug(sql.str().c_str());
00571     auto_ptr&lt;otl_stream&gt; dbStream;
00572 
00573     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00574         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00575     
00576     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00577         
00578         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00579     }
00580     
00581     <span class="comment">// This function also does a select to return the key</span>
00582     
00583     stringstream select;
00584     select &lt;&lt; <span class="stringliteral">"SELECT INV_Item_ID from Inventory_Table where INV_Bar_Code_Number = '"</span>
00585         &lt;&lt; item.<a class="code" href="class_yard_inv_type.html#a6">GetBarCode</a>() &lt;&lt; <span class="stringliteral">"';"</span>;
00586     
00587     auto_ptr&lt;otl_stream&gt; db;
00588     
00589     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00590         db.reset( <span class="keyword">new</span> otl_stream(1, select.str().c_str(), *m_db) );
00591     
00592     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00593         
00594         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00595     }
00596     
00597     <span class="keywordtype">long</span> <span class="keywordtype">int</span> key = 0;
00598     
00599     <span class="keywordflow">try</span> {
00600         *db &gt;&gt; key;
00601     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00602         
00603         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00604     }
00605     <span class="keywordflow">return</span> key;
00606 }
00607 
00608 <span class="keywordtype">long</span> YardDatabase::VendorAdd(<span class="keyword">const</span> <a class="code" href="class_yard_vend_type.html">YardVendType</a>&amp; vendor)
00609 {
00610     <span class="keywordflow">if</span> (!m_db)
00611         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00612     
00613     stringstream sql;
00614     sql &lt;&lt; <span class="stringliteral">"INSERT INTO Vendor_Table values("</span> &lt;&lt; vendor.<a class="code" href="class_yard_vend_type.html#a24">ToString</a>() &lt;&lt; <span class="stringliteral">");"</span>;
00615     
00616     wxLogDebug(sql.str().c_str());
00617     auto_ptr&lt;otl_stream&gt; dbStream;
00618 
00619     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00620         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00621     
00622     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00623         
00624         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00625     }
00626     
00627     <span class="comment">// This function also does a select to return the key</span>
00628     
00629     stringstream select;
00630     select &lt;&lt; <span class="stringliteral">"SELECT VND_ID from Vendor_Table where VND_Name = '"</span>
00631         &lt;&lt; vendor.<a class="code" href="class_yard_vend_type.html#a4">GetName</a>() &lt;&lt; <span class="stringliteral">"';"</span>;
00632     
00633     auto_ptr&lt;otl_stream&gt; db;
00634     
00635     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00636         db.reset( <span class="keyword">new</span> otl_stream(1, select.str().c_str(), *m_db) );
00637     
00638     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00639         
00640         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00641     }
00642     
00643     <span class="keywordtype">long</span> <span class="keywordtype">int</span> key = 0;
00644     
00645     <span class="keywordflow">try</span> {
00646         *db &gt;&gt; key;
00647     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00648         
00649         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00650     }
00651     <span class="keywordflow">return</span> key;
00652 
00653 }
00654 
<a name="l00655"></a><a class="code" href="class_yard_database.html#a42">00655</a> vector&lt;YardGroup&gt; <a class="code" href="class_yard_database.html#a42">YardDatabase::GroupGetAll</a>()<span class="keyword"> const</span>
00656 <span class="keyword"></span>{        
00657     <span class="keywordflow">if</span> (!m_db)
00658         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00659     
00660     stringstream sql;
00661     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Inventory_Group_Table"</span>;
00662     
00663     auto_ptr&lt;otl_stream&gt; dbStream;
00664 
00665     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc</span>
00666         dbStream.reset( <span class="keyword">new</span> otl_stream(50, sql.str().c_str(), *m_db) );
00667     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00668         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00669     }
00670     <span class="keywordflow">return</span> XMLFromStream&lt;YardGroup&gt;(dbStream.get(), <span class="stringliteral">"Inventory_Group_Table"</span>);   
00671 }
00672 
00673 YardGroup YardDatabase::GroupGet(<span class="keywordtype">long</span> key)<span class="keyword"> const</span>
00674 <span class="keyword"></span>{
00675    <span class="keywordflow">if</span> (!m_db)
00676         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00677     
00678     stringstream sql;
00679     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Inventory_Group_Table where INVGRP_Group_ID = "</span>
00680         &lt;&lt; key &lt;&lt; <span class="stringliteral">";"</span>;
00681     wxLogDebug(sql.str().c_str());
00682     auto_ptr&lt;otl_stream&gt; dbStream;
00683 
00684     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00685         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00686     
00687     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00688         
00689         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00690     }
00691         
00692     <span class="keywordflow">return</span> XMLFromStreamSingle&lt;YardGroup&gt;(dbStream.get(), <span class="stringliteral">"Inventory_Group_Table"</span>);
00693 }
00694 
00695 <span class="keywordtype">long</span> YardDatabase::GroupAdd(<span class="keyword">const</span> YardGroup&amp; group)
00696 {
00697     <span class="keywordflow">if</span> (!m_db)
00698         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00699     
00700     stringstream sql;
00701     sql &lt;&lt; <span class="stringliteral">"INSERT INTO Inventory_Group_Table values("</span> &lt;&lt; group.ToString() &lt;&lt; <span class="stringliteral">");"</span>;
00702     
00703     wxLogDebug(sql.str().c_str());
00704     auto_ptr&lt;otl_stream&gt; dbStream;
00705 
00706     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00707         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00708     
00709     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00710         
00711         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00712     }
00713     
00714     <span class="comment">// This function also does a select to return the key</span>
00715     
00716     stringstream select;
00717     select &lt;&lt; <span class="stringliteral">"SELECT INVGRP_Group_ID from Inventory_Group_Table where INVGRP_Group_Name = '"</span>
00718         &lt;&lt; group.GetName() &lt;&lt; <span class="stringliteral">"';"</span>;
00719     
00720     auto_ptr&lt;otl_stream&gt; db;
00721     
00722     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00723         db.reset( <span class="keyword">new</span> otl_stream(1, select.str().c_str(), *m_db) );
00724     
00725     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00726         
00727         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00728     }
00729     
00730     <span class="keywordtype">long</span> <span class="keywordtype">int</span> key = 0;
00731     
00732     <span class="keywordflow">try</span> {
00733         *db &gt;&gt; key;
00734     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00735         
00736         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00737     }
00738     <span class="keywordflow">return</span> key;
00739 
00740     
00741 }
00742 
<a name="l00743"></a><a class="code" href="class_yard_database.html#a15">00743</a> <span class="keywordtype">long</span> <a class="code" href="class_yard_database.html#a15">YardDatabase::CustomerAdd</a>(<span class="keyword">const</span> YardCustType&amp; newCust)
00744 {
00745     <span class="keywordflow">if</span> (!m_db)
00746         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not Initialized."</span>);
00747 
00748     stringstream sql;
00749     sql &lt;&lt; <span class="stringliteral">"INSERT INTO Customer_Table values("</span> &lt;&lt; newCust.ToString() &lt;&lt; <span class="stringliteral">");"</span>;
00750     wxLogDebug(sql.str().c_str());
00751     auto_ptr&lt;otl_stream&gt; dbStream;
00752 
00753     <span class="keywordflow">try</span> {
00754         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00755     } <span class="keywordflow">catch</span> (otl_exception &amp;e) {
00756 
00757         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span> *)e.stm_text);
00758     }
00759     <span class="keywordflow">return</span> 0;
00760 }
00761 
<a name="l00762"></a><a class="code" href="class_yard_database.html#a16">00762</a> vector&lt;YardCustType&gt; <a class="code" href="class_yard_database.html#a16">YardDatabase::CustomerGetAll</a>()
00763 {
00764     <span class="keywordflow">if</span> (!m_db)
00765         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00766     
00767     stringstream sql;
00768     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Customer_Table"</span>;
00769     
00770     auto_ptr&lt;otl_stream&gt; dbStream;
00771 
00772     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc</span>
00773         dbStream.reset( <span class="keyword">new</span> otl_stream(50, sql.str().c_str(), *m_db) );
00774     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00775         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00776     }
00777     <span class="keywordflow">return</span> XMLFromStream&lt;YardCustType&gt;(dbStream.get(), <span class="stringliteral">"Customer_Table"</span>);   
00778     
00779 }
00780 
<a name="l00781"></a><a class="code" href="class_yard_database.html#a19">00781</a> YardCustType <a class="code" href="class_yard_database.html#a19">YardDatabase::CustomerGet</a>(<span class="keywordtype">long</span> key)
00782 {
00783    <span class="keywordflow">if</span> (!m_db)
00784         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00785     
00786     stringstream sql;
00787     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Customer_Table where CUST_Account_Number = "</span>
00788         &lt;&lt; key &lt;&lt; <span class="stringliteral">";"</span>;
00789     wxLogDebug(sql.str().c_str());
00790     auto_ptr&lt;otl_stream&gt; dbStream;
00791 
00792     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00793         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00794     
00795     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00796         
00797         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00798     }
00799         
00800     <span class="keywordflow">return</span> XMLFromStreamSingle&lt;YardCustType&gt;(dbStream.get(), <span class="stringliteral">"Customer_Table"</span>);  
00801 }
00802 
00803 <span class="keywordtype">long</span> YardDatabase::TaxTypeAdd(<span class="keyword">const</span> YardTaxType&amp; taxtype)
00804 {
00805     <span class="keywordflow">if</span> (!m_db)
00806         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not Initialized."</span>);
00807 
00808     stringstream sql;
00809     sql &lt;&lt; <span class="stringliteral">"INSERT INTO Tax_Table values("</span> &lt;&lt; taxtype.ToString() &lt;&lt; <span class="stringliteral">");"</span>;
00810     wxLogDebug(sql.str().c_str());
00811     auto_ptr&lt;otl_stream&gt; dbStream;
00812 
00813     <span class="keywordflow">try</span> {
00814         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00815     } <span class="keywordflow">catch</span> (otl_exception &amp;e) {
00816 
00817         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span> *)e.stm_text);
00818     }
00819     
00820     <span class="comment">// This function also does a select to return the key</span>
00821     
00822     stringstream select;
00823     select &lt;&lt; <span class="stringliteral">"SELECT TAX_ID from Tax_Table where TAX_Name = '"</span>
00824         &lt;&lt; taxtype.GetName() &lt;&lt; <span class="stringliteral">"';"</span>;
00825     
00826     auto_ptr&lt;otl_stream&gt; db;
00827     
00828     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00829         db.reset( <span class="keyword">new</span> otl_stream(1, select.str().c_str(), *m_db) );
00830     
00831     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00832         
00833         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00834     }
00835     
00836     <span class="keywordtype">long</span> <span class="keywordtype">int</span> key = 0;
00837     
00838     <span class="keywordflow">try</span> {
00839         *db &gt;&gt; key;
00840     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00841         
00842         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00843     }
00844     <span class="keywordflow">return</span> key;    
00845 }
00846 
00847 YardTaxType YardDatabase::TaxTypeGet(<span class="keywordtype">long</span> key)<span class="keyword"> const</span>
00848 <span class="keyword"></span>{
00849     <span class="keywordflow">if</span> (!m_db)
00850         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>(<span class="stringliteral">"DB not initialized."</span>);
00851     
00852     stringstream sql;
00853     sql &lt;&lt; <span class="stringliteral">"SELECT * FROM Tax_Table where TAX_ID = "</span>
00854         &lt;&lt; key &lt;&lt; <span class="stringliteral">";"</span>;
00855     wxLogDebug(sql.str().c_str());
00856     auto_ptr&lt;otl_stream&gt; dbStream;
00857 
00858     <span class="keywordflow">try</span> { <span class="comment">// since its a new call might throw bad_alloc, but that is unlikely</span>
00859         dbStream.reset( <span class="keyword">new</span> otl_stream(1, sql.str().c_str(), *m_db) );
00860     
00861     } <span class="keywordflow">catch</span> (otl_exception &amp;e) { <span class="comment">// so just get otl exceptions</span>
00862         
00863         <span class="keywordflow">throw</span> <a class="code" href="class_yard_d_b_exception.html">YardDBException</a>((<span class="keywordtype">char</span> *)e.msg, (<span class="keywordtype">char</span>*)e.stm_text);
00864     }
00865         
00866     <span class="keywordflow">return</span> XMLFromStreamSingle&lt;YardTaxType&gt;(dbStream.get(), <span class="stringliteral">"Tax_Table"</span>);
00867   
00868 }
00869 
00870 string YardDatabase::tab(<span class="keywordtype">int</span> level)
00871 {
00872     string ret;
00873     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; level; i++)
00874         ret += <span class="stringliteral">"    "</span>;
00875     <span class="keywordflow">return</span> ret;
00876 }
00877 
00878 string YardDatabase::escape(<span class="keyword">const</span> string&amp; esc){
00879     string ret;
00880     <span class="comment">// This is to try and cut down on internal buffer resizing</span>
00881     ret.reserve(esc.length());
00882     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; esc.length(); i++)
00883     {
00884         <span class="keywordflow">switch</span> (esc[i]) {
00885             <span class="keywordflow">case</span> (<span class="charliteral">'&lt;'</span>): ret += <span class="stringliteral">"&amp;lt;"</span>; <span class="keywordflow">break</span>;
00886             <span class="keywordflow">case</span> (<span class="charliteral">'&gt;'</span>): ret += <span class="stringliteral">"&amp;gt;"</span>; <span class="keywordflow">break</span>;
00887             <span class="keywordflow">case</span> (<span class="charliteral">'&amp;'</span>): ret += <span class="stringliteral">"&amp;amp;"</span>; <span class="keywordflow">break</span>;
00888             <span class="keywordflow">case</span> (<span class="charliteral">'\''</span>): ret += <span class="stringliteral">"&amp;apos;"</span>; <span class="keywordflow">break</span>;
00889             <span class="keywordflow">case</span> (<span class="charliteral">'"'</span>): ret += <span class="stringliteral">"&amp;quot;"</span>; <span class="keywordflow">break</span>;
00890             <span class="keywordflow">default</span>: ret += esc[i]; <span class="keywordflow">break</span>;
00891         }
00892 
00893     }
00894     <span class="keywordflow">return</span> ret;
00895 }
00896 
<a name="l00897"></a><a class="code" href="class_yard_database.html#a51">00897</a> string <a class="code" href="class_yard_database.html#a51">YardDatabase::ToXML</a>(otl_stream * stream, <span class="keyword">const</span> string&amp; record)<span class="keyword"> const</span>
00898 <span class="keyword"></span>{
00899     
00900     <span class="keywordflow">if</span> (!stream)
00901         <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
00902     stringstream xml;    
00903     <span class="keywordtype">int</span> length = 0;
00904     otl_column_desc* desc = stream-&gt;describe_select(length);
00905 
00906     xml &lt;&lt; tab(0) &lt;&lt; <span class="stringliteral">"&lt;"</span> &lt;&lt; record &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; endl;
00908     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; length; i++)
00909     {
00910         xml &lt;&lt; tab(1) &lt;&lt; <span class="stringliteral">"&lt;"</span> &lt;&lt; desc[i].name;
00911         
00912         <span class="keywordflow">switch</span>(desc[i].otl_var_dbtype) {
00913             <span class="keywordflow">case</span>(otl_var_varchar_long): {
00914                 xml &lt;&lt; <span class="stringliteral">" type=\"xs:string\"&gt;"</span>;
00915                 string i;
00916                 *stream &gt;&gt; i;
00917                 xml &lt;&lt; escape(i);}
00918                 <span class="keywordflow">break</span>;
00919             <span class="keywordflow">case</span>(otl_var_int):{
00920                 xml &lt;&lt; <span class="stringliteral">" type=\"xs:int\"&gt;"</span>;
00921                 <span class="keywordtype">int</span> i;
00922                 *stream &gt;&gt; i;
00923                 xml &lt;&lt; i;}
00924                 <span class="keywordflow">break</span>;
00925              <span class="keywordflow">case</span>(otl_var_char):{
00926                 xml &lt;&lt; <span class="stringliteral">" type=\"xs:string\"&gt;"</span>;
00927                 string i;
00928                 *stream &gt;&gt; i;
00929                 xml &lt;&lt; escape(i);}
00930                 <span class="keywordflow">break</span>;
00931             <span class="keywordflow">case</span>(otl_var_db2date): 
00932             <span class="keywordflow">case</span>(otl_var_db2time): 
00933             <span class="keywordflow">case</span>(otl_var_ltz_timestamp): 
00934             <span class="keywordflow">case</span>(otl_var_timestamp): 
00935             <span class="keywordflow">case</span>(otl_var_tz_timestamp): {
00936                 xml &lt;&lt; <span class="stringliteral">" type=\"xs:dateTime\"&gt;"</span>;
00937                 otl_datetime i;
00938                 *stream &gt;&gt; i;
00939                 stringstream s;
00940                 xml &lt;&lt; i;
00941                 }
00942                 <span class="keywordflow">break</span>;
00943             <span class="keywordflow">case</span>(otl_var_float):{
00944                 xml &lt;&lt; <span class="stringliteral">" type=\"xs:float\"&gt;"</span>;
00945                 <span class="keywordtype">float</span> i;
00946                 *stream &gt;&gt; i;
00947                 xml &lt;&lt; i;}
00948                 <span class="keywordflow">break</span>;
00949             <span class="keywordflow">case</span>(otl_var_double): {
00950                 xml &lt;&lt; <span class="stringliteral">" type=\"xs:double\"&gt;"</span>;
00951                 <span class="keywordtype">double</span> i;
00952                 *stream &gt;&gt; i;
00953                 xml &lt;&lt; i;}
00954                 <span class="keywordflow">break</span>;
00955             <span class="keywordflow">case</span>(otl_var_long_int): {
00956                 xml &lt;&lt; <span class="stringliteral">" type=\"xs:long\"&gt;"</span>;
00957                 <span class="keywordtype">long</span> <span class="keywordtype">int</span> i;
00958                 *stream &gt;&gt; i;
00959                 xml &lt;&lt; i;}
00960                 <span class="keywordflow">break</span>;
00961             <span class="keywordflow">case</span>(otl_var_short):{
00962                 xml &lt;&lt; <span class="stringliteral">" type=\"xs:short\"&gt;"</span>;
00963                 <span class="keywordtype">short</span> i;
00964                 *stream &gt;&gt; i;
00965                 xml &lt;&lt; i;}
00966                 <span class="keywordflow">break</span>;
00967             <span class="keywordflow">case</span>(otl_var_unsigned_int): {
00968                 xml &lt;&lt; <span class="stringliteral">" type=\"xs:unsignedInt\"&gt;"</span>;
00969                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
00970                 *stream &gt;&gt; i;
00971                 xml &lt;&lt; i;}
00972                 <span class="keywordflow">break</span>;
00973 <span class="preprocessor">            #ifdef OTL_BIGINT</span>
00974 <span class="preprocessor"></span>            <span class="keywordflow">case</span>(otl_var_bigint): {
00975                 xml &lt;&lt; <span class="stringliteral">" type=\"xs:integer\"&gt;"</span>;
00976                 <span class="keywordtype">long</span> <span class="keywordtype">long</span> i;
00977                 *stream &gt;&gt; i;
00978                 xml &lt;&lt; i; }
00979                 <span class="keywordflow">break</span>;
00980 <span class="preprocessor">            #endif</span>
00981 <span class="preprocessor"></span>            
00982             <span class="keywordflow">case</span>(otl_var_clob): {
00983                 xml &lt;&lt; <span class="stringliteral">" type=\"xs:string\"&gt;"</span>;
00984                 string i;
00985                 *stream &gt;&gt; i;
00986                 xml &lt;&lt; escape(i); }
00987                 <span class="keywordflow">break</span>;
00988 <span class="preprocessor">            #if 0 </span>
00989 <span class="preprocessor">            case(otl_var_blob): {</span>
00990 <span class="preprocessor"></span>                xml &lt;&lt; <span class="stringliteral">" type=\"xs:string\"&gt;"</span>;
00991                 otl_lob_stream i;
00992                 *stream &gt;&gt; i;
00993                 xml &lt;&lt; i;}
00994                 <span class="keywordflow">break</span>;
00995 <span class="preprocessor">            #endif</span>
00996 <span class="preprocessor"></span>            <span class="keywordflow">default</span>: cerr &lt;&lt; <span class="stringliteral">"Throw a fucking exception"</span> &lt;&lt; endl;
00997                 <span class="keywordflow">break</span>;
00998         }
00999         xml &lt;&lt; <span class="stringliteral">"&lt;/"</span> &lt;&lt; desc[i].name &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; endl;
01000 
01001     }
01002     
01003     xml &lt;&lt; tab(0) &lt;&lt; <span class="stringliteral">"&lt;/"</span> &lt;&lt; record &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; endl;
01004     <span class="keywordflow">return</span> xml.str();
01005 }
01006     
01007 
01008 <span class="preprocessor">#if (defined(YS_TEST_MAIN) || defined(YS_TEST_DB))</span>
01009 <span class="preprocessor"></span>
01010 <span class="preprocessor">#include &lt;iostream&gt;</span>
01011 <span class="preprocessor">#include &lt;vector&gt;</span>
01012 <span class="preprocessor">#include "ys_test.h"</span>
01013 
01014 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
01015 
01016 <span class="preprocessor">#define TEST_DB "localhost"</span>
01017 <span class="preprocessor"></span><span class="preprocessor">#define TEST_DSN "YardSaleTest"</span>
01018 <span class="preprocessor"></span><span class="preprocessor">#define TEST_USER "test"</span>
01019 <span class="preprocessor"></span><span class="preprocessor">#define TEST_PASS "test"</span>
01020 <span class="preprocessor"></span>
01021 <span class="comment">/*</span>
01022 <span class="comment">Tests needed:</span>
01023 <span class="comment">    Add, remove, modify each type.</span>
01024 <span class="comment"></span>
01025 <span class="comment">*/</span>
01026 
01027 <span class="keywordtype">int</span> TaxTest(<a class="code" href="class_yard_database.html">YardDatabase</a> * db)
01028 {
01029     YardTaxType test1;
01030     test1.SetName(<span class="stringliteral">"Leetness Tax"</span>);
01031     test1.SetPercent(0.11);
01032     
01033     <span class="keywordtype">long</span> key = 0;
01034     VERIFY_NO_THROW(key = db-&gt;<a class="code" href="class_yard_database.html#a39">TaxTypeAdd</a>(test1));
01035     
01036     YardTaxType test2;
01037     VERIFY_NO_THROW(test2 = db-&gt;<a class="code" href="class_yard_database.html#a41">TaxTypeGet</a>(key));
01038     
01039     VERIFY(test1.GetName(), test2.GetName());
01040     
01041     <span class="keywordflow">return</span> 0;
01042 }
01043 
01044 <span class="keywordtype">int</span> VendorTest(<a class="code" href="class_yard_database.html">YardDatabase</a> * db)
01045 {
01046     <a class="code" href="class_yard_vend_type.html">YardVendType</a> test1;
01047     
01048     test1.<a class="code" href="class_yard_vend_type.html#a14">SetName</a>(<span class="stringliteral">"ACME"</span>);
01049     test1.<a class="code" href="class_yard_vend_type.html#a15">SetAddress</a>(<span class="stringliteral">"29 Lynwood"</span>);
01050     test1.<a class="code" href="class_yard_vend_type.html#a16">SetCity</a>(<span class="stringliteral">"A-Town"</span>);
01051     test1.<a class="code" href="class_yard_vend_type.html#a17">SetState</a>(<span class="stringliteral">"NC"</span>); 
01052     test1.<a class="code" href="class_yard_vend_type.html#a18">SetZip</a>(<span class="stringliteral">"27777"</span>);
01053     test1.<a class="code" href="class_yard_vend_type.html#a19">SetPhone</a>(<span class="stringliteral">"919-999-8888"</span>);
01054     test1.<a class="code" href="class_yard_vend_type.html#a20">SetSalesRep</a>(<span class="stringliteral">"Bob"</span>);
01055     test1.<a class="code" href="class_yard_vend_type.html#a21">SetSpecialty</a>(<span class="stringliteral">"Pics"</span>);
01056     test1.<a class="code" href="class_yard_vend_type.html#a22">SetEmail</a>(<span class="stringliteral">"acme@hotmail.com"</span>);
01057     test1.<a class="code" href="class_yard_vend_type.html#a23">SetHomePage</a>(<span class="stringliteral">"http://yardsale.sf.net"</span>);
01058     
01059     <span class="keywordtype">long</span> key = 0;
01060     VERIFY_NO_THROW(key = db-&gt;<a class="code" href="class_yard_database.html#a28">VendorAdd</a>(test1));
01061     
01062     <a class="code" href="class_yard_vend_type.html">YardVendType</a> test2;
01063     VERIFY_NO_THROW(test2 = db-&gt;<a class="code" href="class_yard_database.html#a27">VendorGet</a>(key));
01064     
01065     VERIFY(test1.<a class="code" href="class_yard_vend_type.html#a4">GetName</a>(), test2.<a class="code" href="class_yard_vend_type.html#a4">GetName</a>());
01066     
01067     <span class="keywordflow">return</span> 0;
01068 }
01069 
01070 <span class="keywordtype">int</span> GroupTest(<a class="code" href="class_yard_database.html">YardDatabase</a> * db)
01071 {
01072     YardGroup test1;
01073     test1.SetName(<span class="stringliteral">"Spockets"</span>);
01074     
01075     <span class="keywordtype">long</span> key = 0;
01076     VERIFY_NO_THROW(key = db-&gt;<a class="code" href="class_yard_database.html#a44">GroupAdd</a>(test1));
01077     
01078     YardGroup test2;
01079     VERIFY_NO_THROW(test2 = db-&gt;<a class="code" href="class_yard_database.html#a43">GroupGet</a>(key));
01080     
01081     VERIFY(test1.GetName(), test2.GetName());
01082     
01083     <span class="keywordflow">return</span> 0;
01084 }
01085 
01086 <span class="keywordtype">int</span> InventoryTest(<a class="code" href="class_yard_database.html">YardDatabase</a> * db)
01087 {
01088     <span class="comment">// Setup inventory</span>
01089     <a class="code" href="class_yard_inv_type.html">YardInvType</a> test1;
01090     
01091     test1.<a class="code" href="class_yard_inv_type.html#a38">SetSKU</a>(<span class="stringliteral">"BFG-5000"</span>);
01092     test1.<a class="code" href="class_yard_inv_type.html#a40">SetBarCode</a>(<span class="stringliteral">"QWERTY"</span>);
01093     test1.<a class="code" href="class_yard_inv_type.html#a41">SetDescription</a>(<span class="stringliteral">"A very nice object"</span>);
01094     test1.<a class="code" href="class_yard_inv_type.html#a42">SetDepartment</a>(<span class="stringliteral">"Sales"</span>);
01095     test1.<a class="code" href="class_yard_inv_type.html#a43">SetQuantOnHand</a>(69);
01096     test1.<a class="code" href="class_yard_inv_type.html#a44">SetQuantOnOrder</a>(96);
01097     test1.<a class="code" href="class_yard_inv_type.html#a45">SetReorderLevel</a>(30);
01098     test1.<a class="code" href="class_yard_inv_type.html#a46">SetReorderQuant</a>(1000);
01099     test1.<a class="code" href="class_yard_inv_type.html#a48">SetType</a>(<span class="stringliteral">"Widget"</span>);
01100     test1.<a class="code" href="class_yard_inv_type.html#a49">SetWeightLbs</a>(1000.45);
01101     test1.<a class="code" href="class_yard_inv_type.html#a50">SetTaxType</a>(1);
01102     test1.<a class="code" href="class_yard_inv_type.html#a51">SetVendorId</a>(1);
01103     test1.<a class="code" href="class_yard_inv_type.html#a47">SetGroupId</a>(1);
01104     test1.<a class="code" href="class_yard_inv_type.html#a52">SetRetailPrice</a>(34.23);
01105     test1.<a class="code" href="class_yard_inv_type.html#a53">SetWholesalePrice</a>(1000.12);
01106     test1.<a class="code" href="class_yard_inv_type.html#a54">AddBulkPrice</a>(100, 0.12);
01107     test1.<a class="code" href="class_yard_inv_type.html#a54">AddBulkPrice</a>(200, 0.23);
01108     test1.<a class="code" href="class_yard_inv_type.html#a55">RemoveBulkPrice</a>(100);
01109     test1.<a class="code" href="class_yard_inv_type.html#a56">SetOverSized</a>(<span class="keyword">true</span>);
01110     test1.<a class="code" href="class_yard_inv_type.html#a57">SetShipFreight</a>(<span class="keyword">false</span>);
01111     
01112     <span class="comment">// try insert</span>
01113     <span class="keywordtype">long</span> key = 0;
01114     VERIFY_NO_THROW( key = db-&gt;<a class="code" href="class_yard_database.html#a14">InventoryAdd</a>(test1) );
01115     <span class="comment">//if (key == 0) return 1;</span>
01116         
01117     <span class="comment">// try retrieve</span>
01118     <a class="code" href="class_yard_inv_type.html">YardInvType</a> test2;
01119     VERIFY_NO_THROW( test2 = db-&gt;<a class="code" href="class_yard_database.html#a12">InventoryGet</a>(key) );
01120        
01121     vector&lt;YardInvType&gt; invObj;
01122 
01123     <span class="comment">/* Search for an SKU that probably doesn't exist,</span>
01124 <span class="comment">   test to see if the shit bombs when we try to print */</span>
01125     
01126     VERIFY_NO_THROW(invObj = db-&gt;<a class="code" href="class_yard_database.html#a8">InventorySearchSKU</a>(<span class="stringliteral">"BFG-5000"</span>));
01127     VERIFY(invObj.size(), 1);
01128     
01129     <span class="keywordflow">return</span> 0;    
01130 
01131 }
01132 
01134 <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)
01135 {
01136     <a class="code" href="class_yard_database.html">YardDatabase</a> testDB;
01137    
01138     <span class="keywordflow">if</span> (argc == 4) {
01139         testDB.<a class="code" href="class_yard_database.html#a2">Init</a>(argv[1], argv[2], argv[3]);
01140     }
01141     <span class="keywordflow">else</span>
01142     {
01143         testDB.<a class="code" href="class_yard_database.html#a2">Init</a>(TEST_USER, TEST_PASS, TEST_DSN);
01144     }
01145         
01146     <span class="keywordflow">try</span> {
01147         testDB.<a class="code" href="class_yard_database.html#a4">connect</a>();
01148     } 
01149     <span class="keywordflow">catch</span> (<a class="code" href="class_yard_d_b_exception.html">YardDBException</a> &amp;e) 
01150     {
01151         <span class="keywordflow">if</span> (argc == 4) <span class="comment">// command line usage</span>
01152         {
01153             cout &lt;&lt; <span class="stringliteral">"Error: "</span> &lt;&lt; e.GetWhat() &lt;&lt; endl
01154                  &lt;&lt; <span class="stringliteral">"Command line usage: test_db username pass dsn"</span> &lt;&lt; endl;
01155             <span class="keywordflow">return</span> 1;
01156         }
01157         cout &lt;&lt; <span class="stringliteral">"!!!Could not connect to the database, \n"</span>
01158             &lt;&lt; <span class="stringliteral">"the database connection based \n"</span>
01159             &lt;&lt; <span class="stringliteral">"tests will not be run ("</span> &lt;&lt; e.GetWhat() &lt;&lt; <span class="stringliteral">"). \n"</span>
01160             &lt;&lt; <span class="stringliteral">"I you have not setup the testing main for your \n"</span>
01161             &lt;&lt; <span class="stringliteral">"testing database, please do so!!!"</span> &lt;&lt; endl;
01162         <span class="keywordflow">return</span> 1;
01163     }
01164 
01165     TaxTest(&amp;testDB);
01166     VendorTest(&amp;testDB);
01167     GroupTest(&amp;testDB);
01168     InventoryTest(&amp;testDB);
01169     
01170     <span class="keywordflow">return</span> failure;
01171 }
01172 
01173     
01174 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun May 9 23:07:58 2004 for YardSale by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
