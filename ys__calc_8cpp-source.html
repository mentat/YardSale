<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>YardSale: ys_calc.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>ys_calc.cpp</h1><div class="fragment"><pre>00001 <span class="preprocessor">#include &lt;sstream&gt;</span>
00002 <span class="preprocessor">#include &lt;stack&gt;</span>
00003 <span class="preprocessor">#include &lt;iostream&gt;</span>
00004 
00005 <span class="preprocessor">#include "wx/app.h"</span>
00006 <span class="preprocessor">#include "wx/wx.h"</span>
00007 <span class="preprocessor">#include "extra/xrc/xmlres.h"</span>
00008 
00009 <span class="preprocessor">#include "yardsale.h"</span>
00010 <span class="preprocessor">#include "ys_calc.h"</span>
00011 <span class="preprocessor">#include "xmlnode.h"</span>
00012 
00013 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00014 
00015 IMPLEMENT_DYNAMIC_CLASS(<a class="code" href="class_yard_calc.html">YardCalc</a>, wxPanel)
00016 <span class="comment">//when a button is pressed, it's ID matches up here with a function</span>
00017 BEGIN_EVENT_TABLE(<a class="code" href="class_yard_calc.html">YardCalc</a>, wxPanel)
00018     EVT_BUTTON(XRCID(<span class="stringliteral">"ID_CALC_CLEAR"</span>), YardCalc::OnClear)
00019     <span class="comment">//EVT_BUTTON(XRCID("ID_CALC_DOT"), YardCalc::OnNumber)</span>
00020     EVT_BUTTON(XRCID(<span class="stringliteral">"ID_CALC_DOT"</span>), YardCalc::OnDoubleZero)
00021     EVT_BUTTON(XRCID(<span class="stringliteral">"ID_CALC_PLUS"</span>), YardCalc::OnOperator)
00022     EVT_BUTTON(XRCID(<span class="stringliteral">"ID_CALC_MINUS"</span>), YardCalc::OnOperator)
00023     EVT_BUTTON(XRCID(<span class="stringliteral">"ID_CALC_EQUALS"</span>), YardCalc::OnOperator)
00024     EVT_BUTTON(-1, YardCalc::OnNumber)
00025 END_EVENT_TABLE()
00026 
00027 DECLARE_APP(<a class="code" href="class_yard_sale.html">YardSale</a>)
00028 
00029 <a class="code" href="class_yard_calc.html#a0">YardCalc::YardCalc</a>(wxWindow* parent, wxWindowID id, 
00030         <span class="keyword">const</span> wxPoint&amp; pos, <span class="keyword">const</span> wxSize&amp; size, 
00031         <span class="keywordtype">long</span> style, <span class="keyword">const</span> wxString&amp; name)
00032         :wxPanel(parent, id, pos, size, style, name)
00033 {
00034     
00035     wxXmlResource::Get()-&gt;Load(<span class="stringliteral">"res/calc_wdr.xrc"</span>);
00036     wxPanel * panel = wxXmlResource::Get()-&gt;LoadPanel(<span class="keyword">this</span>, <span class="stringliteral">"NumberPad"</span>);
00037     wxSizer * sizer = panel-&gt;GetSizer();
00038     sizer-&gt;SetSizeHints(<span class="keyword">this</span>);
00039     SetSize(sizer-&gt;GetMinSize());
00040         
00041     <span class="comment">//initialize a way to get to the screen</span>
00042     m_screen = (wxTextCtrl *)FindWindow(XRCID(<span class="stringliteral">"ID_CALC_SCREEN"</span>));
00043     
00044     <span class="comment">//make sure that the pointer is active</span>
00045     wxASSERT(m_screen);
00046     
00047     PushBlankNumber();
00048     
00049     CalcInstance m_tempstackitem;
00050 
00051     m_tempstackitem.m_isNumber = <span class="keyword">false</span>;
00052     m_tempstackitem.m_type.m_op = Addition;
00053     m_calcstack.push(m_tempstackitem);
00054     
00055     PushBlankNumber();
00056     
00057     <span class="comment">//so now the stack should have a number pushed onto it, and an operator</span>
00058     RefreshScreen();
00059     Show();
00060     <span class="comment">//DumpStack();</span>
00061 }
00062 
00063 <span class="keywordtype">bool</span> YardCalc::Create(wxWindow* parent, wxWindowID id, 
00064      <span class="keyword">const</span> wxPoint&amp; pos, <span class="keyword">const</span> wxSize&amp; size, <span class="keywordtype">long</span> style, <span class="keyword">const</span> wxString&amp; name)
00065 {
00066     <span class="keywordflow">if</span> ( !wxPanel::Create(parent, id, pos, size, style, name) )
00067         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00068     
00069     wxXmlResource::Get()-&gt;Load(<span class="stringliteral">"res/calc_wdr.xrc"</span>);
00070     wxPanel * panel = wxXmlResource::Get()-&gt;LoadPanel(<span class="keyword">this</span>, <span class="stringliteral">"NumberPad"</span>);
00071     wxSizer * sizer = panel-&gt;GetSizer();
00072     sizer-&gt;SetSizeHints(<span class="keyword">this</span>);
00073     SetSize(sizer-&gt;GetMinSize());
00074         
00075     <span class="comment">//initialize a way to get to the screen</span>
00076     m_screen = (wxTextCtrl *)FindWindow(XRCID(<span class="stringliteral">"ID_CALC_SCREEN"</span>));
00077     
00078     <span class="comment">//make sure that the pointer is active</span>
00079     wxASSERT(m_screen);
00080     
00081     PushBlankNumber();
00082     
00083     CalcInstance m_tempstackitem;
00084 
00085     m_tempstackitem.m_isNumber = <span class="keyword">false</span>;
00086     m_tempstackitem.m_type.m_op = Addition;
00087     m_calcstack.push(m_tempstackitem);
00088     
00089     PushBlankNumber();
00090     
00091     <span class="comment">//so now the stack should have a number pushed onto it, and an operator</span>
00092     RefreshScreen();
00093 }
00094 
00095 <span class="keywordtype">void</span> YardCalc::PushBlankNumber()
00096 {
00097     CalcInstance m_tempstackitem;
00098 
00099     m_tempstackitem.m_isNumber = <span class="keyword">true</span>;
00100     m_tempstackitem.m_type.m_number = <span class="stringliteral">""</span>;
00101     m_calcstack.push(m_tempstackitem);
00102 
00103 }
00104 
00105 <span class="keywordtype">void</span> YardCalc::DumpStack()
00106 {
00107     std::stack&lt;CalcInstance&gt; m_calcstack2;
00108     m_calcstack2 = m_calcstack;
00109     
00110     <span class="keywordflow">while</span> (!m_calcstack2.empty()){
00111         <span class="keywordflow">if</span> (m_calcstack2.top().m_isNumber){
00112    <span class="comment">//         cout &lt;&lt; "STACK: number-&gt;" &lt;&lt; m_calcstack2.top().m_type.m_number &lt;&lt; "\n";</span>
00113         }<span class="keywordflow">else</span>
00114     <span class="comment">//        cout &lt;&lt; "STACK: operator-&gt;" &lt;&lt; "\n";</span>
00115         
00116         m_calcstack2.pop();
00117     }
00118      <span class="comment">//           cout &lt;&lt; "\n\n";</span>
00119 
00120     
00121 }
00122 
<a name="l00123"></a><a class="code" href="class_yard_calc.html#a5">00123</a> <a class="code" href="class_yard_calc.html#a5">YardCalc::~YardCalc</a>()
00124 {
00125     
00126 }
00127   
00128 <span class="keywordtype">void</span> YardCalc::OnDoubleZero(wxCommandEvent &amp; event){
00129     m_calcstack.top().m_type.m_number = DoubleToString(StringToDouble(m_calcstack.top().m_type.m_number) * .01);
00130     
00131     RefreshScreen();
00132 }
00133 
00134 <span class="comment">//recieve input and keep adding it to</span>
00135 <span class="comment">//the current number, each time refreshing the screen</span>
00136 
00137 <span class="keywordtype">void</span> YardCalc::OnNumber(wxCommandEvent &amp; event)
00138 {
00139     wxChar ch;
00140     wxString m_tempstring;
00141     CalcInstance m_tempstackinstance;
00142 
00143     <span class="keywordflow">if</span> (event.GetId() == XRCID(<span class="stringliteral">"ID_CALC_1"</span>))
00144         ch = <span class="charliteral">'1'</span>;
00145      <span class="keywordflow">if</span> (event.GetId() == XRCID(<span class="stringliteral">"ID_CALC_2"</span>))
00146         ch = <span class="charliteral">'2'</span>;
00147       <span class="keywordflow">if</span> (event.GetId() == XRCID(<span class="stringliteral">"ID_CALC_3"</span>))
00148         ch = <span class="charliteral">'3'</span>;
00149        <span class="keywordflow">if</span> (event.GetId() == XRCID(<span class="stringliteral">"ID_CALC_4"</span>))
00150         ch = <span class="charliteral">'4'</span>;
00151         <span class="keywordflow">if</span> (event.GetId() == XRCID(<span class="stringliteral">"ID_CALC_5"</span>))
00152         ch = <span class="charliteral">'5'</span>;
00153          <span class="keywordflow">if</span> (event.GetId() == XRCID(<span class="stringliteral">"ID_CALC_6"</span>))
00154         ch = <span class="charliteral">'6'</span>;
00155          <span class="keywordflow">if</span> (event.GetId() == XRCID(<span class="stringliteral">"ID_CALC_7"</span>))
00156         ch = <span class="charliteral">'7'</span>; 
00157          <span class="keywordflow">if</span> (event.GetId() == XRCID(<span class="stringliteral">"ID_CALC_8"</span>))
00158         ch = <span class="charliteral">'8'</span>; 
00159          <span class="keywordflow">if</span> (event.GetId() == XRCID(<span class="stringliteral">"ID_CALC_9"</span>))
00160         ch = <span class="charliteral">'9'</span>; 
00161          <span class="keywordflow">if</span> (event.GetId() == XRCID(<span class="stringliteral">"ID_CALC_0"</span>))
00162         ch = <span class="charliteral">'0'</span>; 
00163                     
00164     <span class="comment">//check to see if we need to clear the screen</span>
00165     <span class="comment">//aka, we just previously hit an operator</span>
00166    <span class="comment">// if (!m_calcstack.top().m_isNumber)</span>
00167     <span class="comment">//    ClearScreen();</span>
00168         
00169     
00170     <span class="comment">//if the screen has '0' on it, replace it with the digit typed </span>
00171     <span class="keywordflow">if</span> (m_calcstack.top().m_type.m_number.CompareTo(<span class="stringliteral">"0"</span>) == 0 &amp;&amp; m_calcstack.size() == 1){
00172         m_tempstring = ch;
00173         m_calcstack.top().m_type.m_number = m_tempstring;
00174     }
00175     <span class="keywordflow">else</span>{
00176         <span class="keywordflow">if</span> (ch == <span class="charliteral">'.'</span>){
00177             <span class="keywordflow">if</span> (! m_calcstack.top().m_type.m_number.Contains(<span class="stringliteral">"."</span>) ){
00178                 m_calcstack.top().m_type.m_number.Append(ch);
00179             }
00180         }
00181         <span class="keywordflow">else</span>
00182         <span class="comment">//if we get here, we entered a number</span>
00183         m_calcstack.top().m_type.m_number.Append(ch);
00184     }
00185 
00186     RefreshScreen();
00187 }
00188 
00189 <span class="keywordtype">double</span> YardCalc::GetCalcContents(){
00190     <span class="keywordflow">return</span> StringToDouble(m_calcstack.top().m_type.m_number);
00191 }
00192 
00193 <span class="comment">//here we evaluate an expression based upon:</span>
00194 <span class="comment">//      what is on the screen</span>
00195 <span class="comment">//      what is in the memory</span>
00196 <span class="comment">//      the operator (indicated by the state)</span>
00197 <span class="keywordtype">void</span> YardCalc::EvaluateStack(){
00198     CalcInstance arg2 = m_calcstack.top();
00199     m_calcstack.pop();
00200 
00201     <span class="comment">//In the case that there is only one item on the stack, the stack is </span>
00202     <span class="comment">//considered to be evaluated, so just leave it alone and return</span>
00203     <span class="keywordflow">if</span> (m_calcstack.empty()){
00204         m_calcstack.push(arg2);
00205         <span class="keywordflow">return</span>;
00206     }        
00207 
00208     CalcInstance op = m_calcstack.top();
00209     m_calcstack.pop();
00210     CalcInstance arg1 = m_calcstack.top();
00211     m_calcstack.pop();
00212     
00213     <span class="keywordflow">switch</span> (op.m_type.m_op) {
00214         <span class="keywordflow">case</span> (Addition): 
00215             arg1.m_type.m_number = DoubleToString(StringToDouble(arg1.m_type.m_number) + StringToDouble(arg2.m_type.m_number)); <span class="keywordflow">break</span>;
00216         <span class="keywordflow">case</span> (Subtraction):
00217             arg1.m_type.m_number = DoubleToString(StringToDouble(arg1.m_type.m_number) - StringToDouble(arg2.m_type.m_number)); <span class="keywordflow">break</span>;
00218     }
00219   
00220     <span class="comment">//now push back the result</span>
00221     m_calcstack.push(arg1);
00222     
00223     RefreshScreen();
00224     <span class="comment">//DumpStack();</span>
00225 }
00226 
00227 <span class="keywordtype">void</span> YardCalc::ClearScreen(){
00228     m_screen-&gt;SetValue(<span class="stringliteral">""</span>);
00229 }
00230 
00231 <span class="comment">//need to have this function actually push onto the stack?</span>
<a name="l00232"></a><a class="code" href="class_yard_calc.html#a4">00232</a> <span class="keywordtype">void</span> <a class="code" href="class_yard_calc.html#a4">YardCalc::SetCalcContents</a>(<span class="keywordtype">double</span> contents){
00233     <span class="comment">//m_screen-&gt;SetValue(DoubleToString(contents));</span>
00234     m_screen-&gt;SetValue(XMLNode::ToStr(contents, 2).c_str());
00235     <span class="comment">//do more stuff here</span>
00236 }
00237 
00238 wxString YardCalc::DoubleToString(<span class="keywordtype">double</span> num){
00239     
00240     stringstream numbah;
00241     numbah &lt;&lt; num;
00242     <span class="keywordflow">return</span> wxString(numbah.str().c_str());
00243     
00244 }
00245 
00246 <span class="keywordtype">double</span> YardCalc::StringToDouble(wxString str){
00247     <span class="keywordtype">double</span>  tempvalue;
00248     str.ToDouble(&amp;tempvalue);
00249     <span class="keywordflow">return</span> tempvalue;
00250 }
00251 
00255 <span class="keywordtype">void</span> YardCalc::RefreshScreen(){
00256     stringstream num;
00257     num &lt;&lt; m_calcstack.top().m_type.m_number;
00258     m_screen-&gt;SetValue(num.str().c_str());
00259 }
00260 
00261 <span class="keywordtype">void</span> YardCalc::OnOperator(wxCommandEvent &amp; event){
00262     
00263     CalcInstance m_tempinstance;
00264     m_tempinstance.m_isNumber = <span class="keyword">false</span>;
00265 <span class="preprocessor">#if 0</span>
00266 <span class="preprocessor"></span>    <span class="keywordflow">switch</span> (event.GetId()) {
00267         <span class="keywordflow">case</span> (XRCID(<span class="stringliteral">"ID_CALC_PLUS"</span>)): m_tempinstance.m_type.m_op = Addition; <span class="keywordflow">break</span>;
00268         <span class="keywordflow">case</span> (XRCID(<span class="stringliteral">"ID_CALC_MINUS"</span>)): m_tempinstance.m_type.m_op = Subtraction; <span class="keywordflow">break</span>;
00269         <span class="keywordflow">case</span> (XRCID(<span class="stringliteral">"ID_CALC_EQUALS"</span>)): EvaluateStack(); <span class="keywordflow">return</span>;
00270         }
00271 <span class="preprocessor">#endif</span>
00272 <span class="preprocessor"></span>    <span class="comment">//first, evaluate the old stack        </span>
00273     EvaluateStack();
00274     <span class="comment">//next, push on my operator</span>
00275     m_calcstack.push(m_tempinstance);
00276     <span class="comment">//now push a blank number, to be replaced by the real one</span>
00277     PushBlankNumber();
00278         
00279 }
00280 
00281 <span class="keywordtype">void</span> YardCalc::OnClear(wxCommandEvent &amp; event){
00282     <span class="keywordflow">while</span> (!m_calcstack.empty()){
00283         m_calcstack.pop();
00284     }
00285         
00286     PushBlankNumber();
00287 
00288     RefreshScreen();
00289 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun May 9 23:07:58 2004 for YardSale by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
