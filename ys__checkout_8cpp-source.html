<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>YardSale: ys_checkout.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>ys_checkout.cpp</h1><div class="fragment"><pre>00001 <span class="preprocessor">#include "ys_checkout.h"</span>
00002 <span class="preprocessor">#include "extra/xrc/xmlres.h"</span>
00003 <span class="preprocessor">#include "wx/wx.h"</span>
00004 <span class="preprocessor">#include "wx/app.h"</span>
00005 
00006 <span class="preprocessor">#include "yardsale.h"</span>
00007 <span class="preprocessor">#include "ys_exception.h"</span>
00008 <span class="preprocessor">#include "ys_inv_type.h"</span>
00009 <span class="preprocessor">#include "ys_database.h"</span>
00010 <span class="preprocessor">#include "ys_calc.h"</span>
00011 <span class="preprocessor">#include "ys_config.h"</span>
00012 
00013 <span class="preprocessor">#include "receipt.h"</span>
00014 
00015 <a class="code" href="class_receipt.html">Receipt</a> YardCheckout::m_rec;
00016 
00017 BEGIN_EVENT_TABLE(<a class="code" href="class_yard_checkout.html">YardCheckout</a>, wxDialog)
00018     EVT_BUTTON(XRCID(<span class="stringliteral">"ID_CO_BACK"</span>), YardCheckout::OnBack)
00019     EVT_BUTTON(XRCID(<span class="stringliteral">"ID_CO_PRINT"</span>), YardCheckout::OnPrint)
00020     EVT_BUTTON(XRCID(<span class="stringliteral">"ID_CO_FINISH"</span>), YardCheckout::OnFinish)
00021     EVT_BUTTON(XRCID(<span class="stringliteral">"ID_CO_CASH"</span>), YardCheckout::OnCash)
00022 END_EVENT_TABLE()
00023 
00024 DECLARE_APP(<a class="code" href="class_yard_sale.html">YardSale</a>)
00025 
<a name="l00026"></a><a class="code" href="class_yard_checkout.html#a0">00026</a> <a class="code" href="class_yard_checkout.html#a0">YardCheckout::YardCheckout</a>(wxWindow* parent, wxWindowID id, <span class="keyword">const</span> wxString&amp; title,
00027                    <span class="keyword">const</span> wxPoint&amp; pos, <span class="keyword">const</span> wxSize&amp; size, <span class="keywordtype">long</span> style, <span class="keyword">const</span> wxString&amp; name)
00028 :wxDialog(parent, id, title, pos, size, style, name), m_mode(None), m_ref(0)
00029 {
00030     m_rec.<a class="code" href="class_receipt.html#a2">Init</a>(YardConfig::GetPrinterPort().c_str());
00031     wxLogDebug(wxT(<span class="stringliteral">"Setting printer to: %s"</span>), YardConfig::GetPrinterPort().c_str());
00032     wxXmlResource::Get()-&gt;Load(<span class="stringliteral">"res/checkout_wdr.xrc"</span>);
00033     wxPanel * panel = wxXmlResource::Get()-&gt;LoadPanel(<span class="keyword">this</span>, <span class="stringliteral">"CashOut"</span>);
00034     
00035     m_calc = <span class="keyword">new</span> <a class="code" href="class_yard_calc.html">YardCalc</a>(panel, -1);
00036     wxXmlResource::Get()-&gt;AttachUnknownControl(wxT(<span class="stringliteral">"ID_CO_NUM_PAD"</span>),
00037                                                 m_calc);
00038     
00039      m_cashButt = static_cast&lt;wxButton *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_CO_CASH"</span>)));
00040      m_checkButt = static_cast&lt;wxButton *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_CO_CHECK"</span>)));
00041      m_tabButt = static_cast&lt;wxButton *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_CO_TAB"</span>)));
00042      m_visaButt = static_cast&lt;wxButton *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_CO_VISA"</span>)));
00043      m_mcButt = static_cast&lt;wxButton *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_CO_MC"</span>)));
00044      m_accButt = static_cast&lt;wxButton *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_CO_ACCOUNT"</span>)));
00045      m_backButt = static_cast&lt;wxButton *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_CO_BACK"</span>)));
00046     
00047      m_calc-&gt;Disable();
00048      wxSizer * sizer = panel-&gt;GetSizer();
00049      sizer-&gt;SetSizeHints(<span class="keyword">this</span>);
00050      SetSize(wxSize(600,400));
00051      Centre();  
00052      
00053      m_rec.<a class="code" href="class_receipt.html#a3">Clear</a>();
00054 
00055 }
00056 
<a name="l00057"></a><a class="code" href="class_yard_checkout.html#a1">00057</a> <a class="code" href="class_yard_checkout.html#a1">YardCheckout::~YardCheckout</a>()
00058 {
00059 }
00060 
00061 <span class="keywordtype">void</span> YardCheckout::SetCost(<span class="keywordtype">double</span> subTotal, <span class="keywordtype">double</span> tax, <span class="keywordtype">double</span> total)
00062 {
00063     m_subTotal = subTotal;
00064     m_tax = tax;
00065     m_total = total;
00066     
00067     m_calc-&gt;<a class="code" href="class_yard_calc.html#a4">SetCalcContents</a>(total);
00068     
00069 }
00070 
00071 <span class="keywordtype">void</span> YardCheckout::OnBack(wxCommandEvent&amp; event)
00072 {
00073     wxLogDebug(wxT(<span class="stringliteral">"OnBack"</span>));
00074     EndModal(1);
00075 }
00076 
00077 <span class="keywordtype">void</span> YardCheckout::OnPrint(wxCommandEvent&amp; event)
00078 {
00079     wxLogDebug(wxT(<span class="stringliteral">"OnPrint"</span>));
00080     
00081     <span class="keywordflow">if</span> (!m_ref)
00082     {
00083         wxLogDebug(wxT(<span class="stringliteral">"No reference."</span>));
00084         <span class="keywordflow">return</span>;
00085     }
00086     
00087     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; m_ref-&gt;size(); i++)
00088     {
00089         wxLogDebug(wxT(<span class="stringliteral">"ToPrinter: %s"</span>), (*m_ref)[i].GetName().c_str());
00090         m_rec.<a class="code" href="class_receipt.html#a7">additem</a>((*m_ref)[i].GetName(), (*m_ref)[i].GetRetailPriceS());
00091     }
00092     
00093     m_rec.<a class="code" href="class_receipt.html#a8">totdata</a>(XMLNode::ToStr(m_subTotal, 2), XMLNode::ToStr(m_tax,2), XMLNode::ToStr(m_total, 2));
00094     
00095     <span class="keywordflow">if</span> (m_mode == CashDone)
00096     {
00097         m_rec.<a class="code" href="class_receipt.html#a9">change</a>(<span class="stringliteral">"Cash"</span>, XMLNode::ToStr(m_tender, 2), 
00098             XMLNode::ToStr(m_tender - m_total, 2));
00099     }
00100     
00101     m_rec.<a class="code" href="class_receipt.html#a10">print</a>();
00102     
00103 }
00104 
00105 <span class="keywordtype">void</span> YardCheckout::OnCash(wxCommandEvent&amp; event)
00106 {
00107     <span class="keywordflow">if</span> (m_mode == None)
00108     {
00109         m_calc-&gt;Enable();
00110         m_mode = Cash;
00111     
00112         m_cashButt-&gt;SetLabel(wxT(<span class="stringliteral">"Done"</span>));
00113         
00114         m_checkButt-&gt;Disable();
00115         m_tabButt-&gt;Disable();
00116         m_visaButt-&gt;Disable();
00117         m_mcButt-&gt;Disable();
00118         m_accButt-&gt;Disable();
00119         
00120         m_backButt-&gt;Disable();
00121         
00122     }
00123     <span class="keywordflow">else</span>
00124     {
00125         m_tender = m_calc-&gt;<a class="code" href="class_yard_calc.html#a3">GetCalcContents</a>();
00126         m_calc-&gt;<a class="code" href="class_yard_calc.html#a4">SetCalcContents</a>(m_tender - m_total);       
00127         m_calc-&gt;Disable();
00128         m_mode = CashDone;
00129 
00130         <span class="comment">//open drawer</span>
00131     }
00132     
00133 }
00134 
00135 <span class="keywordtype">void</span> YardCheckout::OnFinish(wxCommandEvent&amp; event)
00136 {
00137     wxLogDebug(wxT(<span class="stringliteral">"OnFinish"</span>));
00138     EndModal(0);
00139     
00140 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun May 9 23:07:58 2004 for YardSale by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
