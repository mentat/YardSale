<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>YardSale: ys_about_gl.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>ys_about_gl.cpp</h1><div class="fragment"><pre>00001 <span class="preprocessor">#include "ys_about_gl.h"</span>
00002 <span class="preprocessor">#include "wx/wx.h"</span>
00003 
00004 <span class="preprocessor">#include "ys_build.h"</span>
00005 
00006 <span class="keyword">enum</span> { ID_ABOUT_OK = 14050, ID_TIMER };
00007 
00008 BEGIN_EVENT_TABLE(<a class="code" href="class_yard_about_g_l.html">YardAboutGL</a>, wxDialog)
00009     EVT_BUTTON(ID_ABOUT_OK, YardAboutGL::OnOK)
00010     EVT_TIMER(ID_TIMER, YardAboutGL::OnTimer)
00011     EVT_PAINT(YardAboutGL::OnPaint)
00012     EVT_IDLE(YardAboutGL::OnIdle)
00013 END_EVENT_TABLE()
00014 
00015 <span class="keywordtype">int</span> GetLines(<span class="keyword">const</span> wxString&amp; str)
00016 {
00017     <span class="keywordtype">int</span> lines = 0;
00018     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; str.length(); i++)
00019         <span class="keywordflow">if</span> (str[i] == <span class="charliteral">'\n'</span>)
00020             lines++;
00021     lines++;
00022     <span class="keywordflow">return</span> lines;
00023 }
00024 
00025 <span class="keywordtype">int</span> GetWidth(<span class="keyword">const</span> wxString&amp; str)
00026 {
00027     <span class="keywordtype">int</span> width = 0;
00028     <span class="keywordtype">int</span> cur = 0;
00029     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; str.length(); i++)
00030     {
00031         <span class="keywordflow">if</span> (str[i] != <span class="charliteral">'\n'</span>)
00032             cur++;
00033         <span class="keywordflow">else</span>
00034             <span class="keywordflow">if</span> (cur &gt; width)
00035                 width = cur;
00036         cur = 0;
00037     }
00038             
00039     <span class="keywordflow">return</span> width;
00040   
00041 }
00042 
<a name="l00043"></a><a class="code" href="class_yard_about_g_l.html#a0">00043</a> <a class="code" href="class_yard_about_g_l.html#a0">YardAboutGL::YardAboutGL</a>(wxWindow* parent, wxWindowID id, <span class="keyword">const</span> wxString&amp; title,
00044                    <span class="keyword">const</span> wxPoint&amp; pos, <span class="keyword">const</span> wxSize&amp; size, <span class="keywordtype">long</span> style, <span class="keyword">const</span> wxString&amp; name)
00045 :wxDialog(parent, id, title, pos, size, style, name), m_timer(0)
00046 {
00047 
00048     <span class="comment">//m_bitmap.LoadFile("res/flower.jpg", wxBITMAP_TYPE_JPEG);</span>
00049     m_cpy.LoadFile(<span class="stringliteral">"res/flower.jpg"</span>, wxBITMAP_TYPE_JPEG);
00050     SetSize(wxSize(500,400));
00051     m_font.SetPointSize(20);
00052     m_y = 400;
00053     Centre();
00054     m_text.Printf(<span class="stringliteral">"YardSale %.3f (%s)\n\nCopyright 2004 ASLS"</span>
00055                   <span class="stringliteral">"\nGNU Public License\n\n"</span>
00056                   <span class="stringliteral">"\nJesse Lovelace\nAdam Parish\nMike Swigon\n"</span>
00057                   <span class="stringliteral">"\nJay Johnston\nJohn Lamb\nCameron Watts\n\n"</span>
00058                   <span class="stringliteral">"\nYardSale uses:\n\nwxWindows\nMySQL\n"</span>
00059                   <span class="stringliteral">"unixODBC\nGDChart\nSablotron"</span>, GetVersion(), YS_CODENAME);
00060     
00061     wxClientDC  dc(<span class="keyword">this</span>);
00062     dc.SetFont(m_font);
00063     dc.GetTextExtent(m_text, &amp;m_txtWidth, &amp;m_txtHeight);
00064     <span class="comment">/*</span>
00065 <span class="comment">    wxLogDebug("1");</span>
00066 <span class="comment">    wxMemoryDC memDC;</span>
00067 <span class="comment">    wxLogDebug("2");</span>
00068 <span class="comment">    </span>
00069 <span class="comment">    m_textBmp.Create(m_txtWidth, m_txtHeight);</span>
00070 <span class="comment">    memDC.SelectObject(m_textBmp);</span>
00071 <span class="comment">    wxBrush brush(*wxBLACK, wxTRANSPARENT);</span>
00072 <span class="comment">    memDC.SetBackground(brush);</span>
00073 <span class="comment">    memDC.SetBackgroundMode( wxTRANSPARENT);</span>
00074 <span class="comment">    memDC.SetTextForeground(*wxWHITE);</span>
00075 <span class="comment">    memDC.SetFont(m_font);</span>
00076 <span class="comment">    </span>
00077 <span class="comment">    wxLogDebug("3");  </span>
00078 <span class="comment">    memDC.DrawText(m_text, 0,0);</span>
00079 <span class="comment">   // wxMask mask(m_textBmp, *wxBLACK);</span>
00080 <span class="comment">    */</span>
00081 
00082     m_timer = <span class="keyword">new</span> wxTimer(<span class="keyword">this</span>, ID_TIMER);
00083     m_timer-&gt;Start(50);
00084        
00085 }
00086 
<a name="l00087"></a><a class="code" href="class_yard_about_g_l.html#a1">00087</a> <a class="code" href="class_yard_about_g_l.html#a1">YardAboutGL::~YardAboutGL</a>()
00088 {
00089     <span class="keywordflow">if</span> (m_timer)
00090     {
00091         m_timer-&gt;Stop();
00092     }
00093     
00094 }
00095 
00096 <span class="keywordtype">void</span> YardAboutGL::OnIdle(wxIdleEvent&amp; event)
00097 {
00098     
00099    <span class="comment">// Refresh(false);</span>
00100 }
00101 
<a name="l00102"></a><a class="code" href="class_yard_about_g_l.html#a3">00102</a> <span class="keywordtype">void</span> <a class="code" href="class_yard_about_g_l.html#a3">YardAboutGL::OnTimer</a>(wxTimerEvent&amp; event)
00103 {
00104 
00105     Refresh(<span class="keyword">false</span>);
00106 }
00107 
<a name="l00108"></a><a class="code" href="class_yard_about_g_l.html#a4">00108</a> <span class="keywordtype">void</span> <a class="code" href="class_yard_about_g_l.html#a4">YardAboutGL::OnPaint</a>(wxPaintEvent&amp; event)
00109 {
00110 
00111     wxPaintDC dc(<span class="keyword">this</span>);
00112     PrepareDC(dc);
00113 
00114     wxMemoryDC memDC;
00115     memDC.SelectObject(m_cpy);
00116     <span class="comment">//wxMemoryDC txtDC;</span>
00117     <span class="comment">//txtDC.SelectObject(m_textBmp);</span>
00118   
00119     <span class="keywordtype">int</span> x = 500 - m_txtWidth; <span class="comment">// this is start of text</span>
00120 
00121     <span class="keywordtype">int</span> bottom = 0;
00122     
00123     <span class="keywordflow">if</span> ((m_y + m_txtHeight) &gt; 400)
00124         bottom = 400;
00125     <span class="keywordflow">else</span>
00126         bottom = m_y + m_txtHeight;
00127     
00128     <span class="keywordtype">int</span> height = m_txtHeight;
00129     height += 400; <span class="comment">// make height 400 bigger to wrap text</span>
00130     
00131     <span class="comment">//memDC.Blit(100,m_y, width, vheight, &amp;origDC, 0, 0); // blit in "clear" from orig</span>
00132     <span class="comment">//memDC.Blit(x,0, 500, 400, &amp;origDC, x,0);  </span>
00133     
00134     <span class="comment">//memDC.SetBackgroundMode( wxTRANSPARENT);</span>
00135     <span class="comment">//memDC.SetTextForeground(*wxWHITE);</span>
00136     
00137     m_y = (m_y - 1);
00138     <span class="keywordflow">if</span> (m_y &lt; ((400 - (height))))
00139         m_y = 400;
00140     
00141     wxRegionIterator upd(GetUpdateRegion()); <span class="comment">// get the update rect list</span>
00142     wxRegion mask(0,0,500,400);
00143     
00144     <span class="keywordflow">while</span> (upd)
00145     {
00146         mask.Subtract(upd.GetRect());
00147         
00148         upd ++ ;
00149     }
00150     mask.Subtract(wxRect(x,m_y,500, bottom));
00151     
00152     wxBrush brush(*wxBLACK, wxTRANSPARENT);
00153     dc.SetBackground(brush);
00154     dc.DestroyClippingRegion();
00155     dc.SetClippingRegion(mask);
00156   
00157     dc.Blit(0,0, 500, 400, &amp;memDC,0, 0, wxCOPY, <span class="keyword">true</span>);
00158     dc.SetBackgroundMode( wxTRANSPARENT);
00159     dc.SetTextForeground(*wxWHITE);
00160     dc.SetFont(m_font);
00161     <span class="comment">//dc.SetLogicalFunction(wxINVERT);</span>
00162     dc.DrawText(m_text, x, m_y);
00163     <span class="comment">//dc.Blit(x,m_y, 500, 400, &amp;txtDC, 0, m_y, wxCOPY, true); </span>
00164     <span class="comment">//dc.DrawBitmap(m_textBmp, x, m_y, true);</span>
00165 }
00166 
<a name="l00167"></a><a class="code" href="class_yard_about_g_l.html#a2">00167</a> <span class="keywordtype">void</span> <a class="code" href="class_yard_about_g_l.html#a2">YardAboutGL::OnOK</a>(wxCommandEvent&amp; event)
00168 {
00169     EndModal(0);
00170 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun May 9 23:07:58 2004 for YardSale by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
