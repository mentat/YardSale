<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>YardSale: ys_employee.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>ys_employee.cpp</h1><div class="fragment"><pre>00001 <span class="preprocessor">#include "extra/xrc/xmlres.h"</span>
00002 <span class="preprocessor">#include "wx/app.h"</span>
00003 <span class="preprocessor">#include "wx/listctrl.h"</span>
00004 <span class="preprocessor">#include "wx/treectrl.h"</span>
00005 <span class="preprocessor">#include "wx/sizer.h"</span>
00006 <span class="preprocessor">#include "wx/log.h"</span>
00007 <span class="preprocessor">#include "wx/stattext.h"</span>
00008 
00009 <span class="preprocessor">#include "ys_employee.h"</span>
00010 <span class="preprocessor">#include "ys_exception.h"</span>
00011 <span class="preprocessor">#include "ys_database.h"</span>
00012 <span class="preprocessor">#include "ys_new_employ.h"</span>
00013 <span class="preprocessor">#include "yardsale.h"</span>
00014 
00015 <span class="preprocessor">#include "images/worker_16x16.xpm"</span>
00016 
00017 DECLARE_APP(<a class="code" href="class_yard_sale.html">YardSale</a>)
00018 
00019 <span class="keyword">class </span>empItemData: <span class="keyword">public</span> wxTreeItemData
00020 {
00021  <span class="keyword">public</span>:
00022     empItemData(<span class="keywordtype">long</span> id): 
00023         wxTreeItemData(), m_id(id) {}
00024     ~empItemData() {}
00025     
00026     <span class="keyword">const</span> <span class="keywordtype">long</span> GetID() { <span class="keywordflow">return</span> m_id; }
00027 
00028  <span class="keyword">private</span>:
00029     <span class="keywordtype">long</span> m_id;  
00030 };
00031 
00032 BEGIN_EVENT_TABLE(<a class="code" href="class_yard_employee.html">YardEmployee</a>, wxDialog)
00033     EVT_TREE_SEL_CHANGED(XRCID(<span class="stringliteral">"ID_EMPLOY_TREE"</span>), YardEmployee::OnChange)
00034     EVT_BUTTON(XRCID(<span class="stringliteral">"ID_EMPLOY_NEW"</span>), YardEmployee::OnNew)
00035     EVT_BUTTON(XRCID(<span class="stringliteral">"ID_EMPLOY_EXIT"</span>), YardEmployee::OnClose)
00036     EVT_TEXT(-1, YardEmployee::OnModify)
00037     EVT_BUTTON(XRCID(<span class="stringliteral">"ID_EMPLOY_SAVE"</span>), YardEmployee::OnSave)
00038 END_EVENT_TABLE()
00039 
00040 YardEmployee::YardEmployee(wxWindow* parent, wxWindowID id, 
00041     <span class="keyword">const</span> wxString&amp; title, <span class="keyword">const</span> wxPoint&amp; pos,
00042     <span class="keyword">const</span> wxSize&amp; size, <span class="keywordtype">long</span> style, <span class="keyword">const</span> wxString&amp; name)
00043 :wxDialog(parent, id, title, pos, size, style, name), m_loading(true) {
00044     wxBusyCursor busy();
00045     wxXmlResource::Get()-&gt;Load(<span class="stringliteral">"res/employee.xrc"</span>);
00046     wxPanel * panel = wxXmlResource::Get()-&gt;LoadPanel(<span class="keyword">this</span>, <span class="stringliteral">"Employee"</span>);
00047     wxSizer * sizer = panel-&gt;GetSizer();
00048     sizer-&gt;SetSizeHints(<span class="keyword">this</span>);
00049     SetSize(wxSize(600,400));
00050     Centre();
00051     
00052 <span class="preprocessor">    #if 0</span>
00053 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (wxGetApp().Full())
00054         ShowFullScreen(<span class="keyword">true</span>);
00055 <span class="preprocessor">    #endif</span>
00056 <span class="preprocessor"></span>    m_pic = static_cast&lt;wxStaticBitmap *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_EMPLOY_PICTURE"</span>)));
00057     m_sig = static_cast&lt;wxStaticBitmap *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_EMPLOY_SIG"</span>)));
00058     m_tree = static_cast&lt;wxTreeCtrl *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_EMPLOY_TREE"</span>)));
00059     m_first = static_cast&lt;wxTextCtrl *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_EMPLOY_FIRST"</span>)));
00060     m_middle = static_cast&lt;wxTextCtrl *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_EMPLOY_MIDDLE"</span>)));
00061     m_last = static_cast&lt;wxTextCtrl *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_EMPLOY_LAST"</span>)));
00062     m_address = static_cast&lt;wxTextCtrl *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_EMPLOY_ADDRESS"</span>)));
00063     m_id = static_cast&lt;wxTextCtrl *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_EMPLOY_ID"</span>)));
00064     m_taxid = static_cast&lt;wxTextCtrl *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_EMPLOY_TAX_ID"</span>)));
00065     m_phone = static_cast&lt;wxTextCtrl *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_EMPLOY_PHONE"</span>)));
00066     m_position = static_cast&lt;wxStaticText *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_EMPLOY_POSITION"</span>)));
00067     m_save = static_cast&lt;wxButton *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_EMPLOY_SAVE"</span>)));
00068     m_hire = static_cast&lt;wxStaticText *&gt;(FindWindow(XRCID(<span class="stringliteral">"ID_EMPLOY_HIRE"</span>)));
00069     
00070     m_save-&gt;Show(<span class="keyword">false</span>);
00071     m_id-&gt;Enable(<span class="keyword">false</span>);
00072     m_taxid-&gt;Enable(<span class="keyword">false</span>);
00073     
00074     CreateImageList(m_tree);
00075     LoadTreeItems(m_tree);
00076     <span class="comment">//ID_EMPLOY_PICTURE</span>
00077     m_loading = <span class="keyword">false</span>;
00078     
00079 }
00080 
00081 <span class="keywordtype">void</span> YardEmployee::LoadTreeItems(wxTreeCtrl * tree)
00082 {
00083     <span class="comment">//tree-&gt;SetWindowStyleFlag(wxTR_NO_LINES | wxTR_HIDE_ROOT | wxTR_FULL_ROW_HIGHLIGHT);</span>
00084     tree-&gt;AddRoot(wxT(<span class="stringliteral">"Root"</span>));
00085     tree-&gt;SetIndent(10);
00086     tree-&gt;SetSpacing(3);
00087     
00088     vector&lt;YardEmployeeType&gt; employees;
00089     
00090     <span class="keywordflow">try</span> {
00091         employees = wxGetApp().DB().EmployeeGetAll();
00092     }
00093     <span class="keywordflow">catch</span> (<a class="code" href="class_yard_d_b_exception.html">YardDBException</a>&amp; e)
00094     {
00095         wxLogDebug(wxT(<span class="stringliteral">"Error (emp load): %s, %s"</span>),e.what(), e.GetSQL().c_str());
00096         <span class="keywordflow">return</span>;
00097     }
00098     wxLogDebug(wxT(<span class="stringliteral">"Got %d employees"</span>), employees.size());
00099     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; employees.size(); i++)
00100     {
00101         wxTreeItemId groupid = tree-&gt;AppendItem(tree-&gt;GetRootItem(),
00102             employees[i].GetFirstLast().c_str(), 0,0,
00103             <span class="keyword">new</span> empItemData(employees[i].GetId()));
00104     }
00105     
00106 }
00107 
00108 <span class="keywordtype">void</span> YardEmployee::OnClose(wxCommandEvent&amp; event)
00109 {
00110     wxLogDebug(wxT(<span class="stringliteral">"OnClose"</span>));
00111     EndModal(0);
00112     
00113 }
00114     
00115 YardEmployee::~YardEmployee()
00116 {
00117    
00118 
00119 }
00120 
00121 <span class="keywordtype">void</span> YardEmployee::OnSave(wxCommandEvent&amp; event)
00122 {
00123     wxLogDebug(wxT(<span class="stringliteral">"OnSave"</span>)); 
00124        
00125     m_emp.<a class="code" href="class_yard_employee_type.html#a25">SetFirstName</a>(m_first-&gt;GetValue().c_str());
00126     m_emp.<a class="code" href="class_yard_employee_type.html#a26">SetMiddleName</a>(m_middle-&gt;GetValue().c_str());
00127     m_emp.<a class="code" href="class_yard_employee_type.html#a27">SetLastName</a>(m_last-&gt;GetValue().c_str());
00128     m_emp.<a class="code" href="class_yard_employee_type.html#a28">SetAddress</a>(m_address-&gt;GetValue().c_str());
00129     m_emp.<a class="code" href="class_yard_employee_type.html#a32">SetPhone</a>(m_phone-&gt;GetValue().c_str());
00130     
00131     <span class="keywordflow">try</span> {
00132         <span class="comment">//wxGetApp().DB().EmployeeUpdate(m_emp);</span>
00133     }
00134     <span class="keywordflow">catch</span> (<a class="code" href="class_yard_d_b_exception.html">YardDBException</a>&amp; e)
00135     {
00136         wxMessageBox(wxT(<span class="stringliteral">"Could not save information."</span>), 
00137             wxT(<span class="stringliteral">"Save Error"</span>), wxOK, <span class="keyword">this</span>);
00138         <span class="keywordflow">return</span>;
00139     }
00140 
00141     m_save-&gt;Show(<span class="keyword">false</span>);
00142 }
00143 
00144 <span class="keywordtype">void</span> YardEmployee::OnModify(wxCommandEvent&amp; event)
00145 {
00146     <span class="comment">//wxLogDebug(wxT("OnModify"));</span>
00147     m_save-&gt;Show(<span class="keyword">true</span>);
00148     
00149 }
00150 
00151 <span class="keywordtype">void</span> YardEmployee::CreateImageList(wxTreeCtrl * tree)
00152 {
00153     <span class="comment">// Make an image list containing small icons</span>
00154     wxImageList *images = <span class="keyword">new</span> wxImageList(16, 16, <span class="keyword">true</span>);
00155 
00156     wxIcon icons[1];
00157     
00158     icons[0] = wxIcon(worker_16x16_xpm);
00159     
00160     <span class="keywordflow">for</span> ( size_t i = 0; i &lt; WXSIZEOF(icons); i++ )
00161     { 
00162         images-&gt;Add(wxBitmap(icons[i]));
00163     }
00164 
00165     tree-&gt;AssignImageList(images);
00166 }
00167 
00168 <span class="keywordtype">void</span> YardEmployee::OnChange(wxTreeEvent&amp; event)
00169 {
00170     m_loading = <span class="keyword">true</span>;
00171     empItemData * data = static_cast&lt;empItemData *&gt;(m_tree-&gt;GetItemData(event.GetItem()));
00172 
00173     <span class="keywordflow">if</span> (!data)
00174         <span class="keywordflow">return</span>;
00175     
00176     <span class="keywordflow">try</span> {
00177         m_emp = wxGetApp().DB().EmployeeGet(data-&gt;GetID());
00178     }
00179     <span class="keywordflow">catch</span> (<a class="code" href="class_yard_d_b_exception.html">YardDBException</a>&amp; e)
00180     {
00181         wxLogDebug(wxT(<span class="stringliteral">"Error (employee not loaded): %s, %s"</span>),e.what(), e.GetSQL().c_str());
00182         <span class="keywordflow">return</span>;
00183     }
00184         
00185     <span class="keywordflow">if</span> (m_emp.<a class="code" href="class_yard_employee_type.html#a19">GetPicLocal</a>() != <span class="stringliteral">""</span>)
00186     {
00187         wxImage pic(m_emp.<a class="code" href="class_yard_employee_type.html#a19">GetPicLocal</a>().c_str());
00188         <span class="keywordflow">if</span> (pic.Ok())
00189             m_pic-&gt;SetBitmap(pic);
00190         <span class="keywordflow">else</span>
00191             wxLogDebug(wxT(<span class="stringliteral">"Bad image data (pic)."</span>));
00192     }
00193     <span class="keywordflow">else</span>
00194         m_pic-&gt;SetBitmap(wxImage(<span class="stringliteral">"res/ys_employee_128x128.png"</span>));
00195     
00196     <span class="keywordflow">if</span> (m_emp.<a class="code" href="class_yard_employee_type.html#a20">GetSigLocal</a>() != <span class="stringliteral">""</span>)
00197     {
00198         wxImage sig(m_emp.<a class="code" href="class_yard_employee_type.html#a20">GetSigLocal</a>().c_str());
00199         <span class="keywordflow">if</span> (sig.Ok())
00200             m_sig-&gt;SetBitmap(sig);
00201         <span class="keywordflow">else</span>
00202             wxLogDebug(wxT(<span class="stringliteral">"Bad image data (sig)."</span>));
00203     }
00204     <span class="keywordflow">else</span>
00205         m_sig-&gt;SetBitmap(wxNullBitmap);
00206     
00207     m_first-&gt;SetValue(m_emp.<a class="code" href="class_yard_employee_type.html#a9">GetFirst</a>().c_str());
00208     m_middle-&gt;SetValue(m_emp.<a class="code" href="class_yard_employee_type.html#a10">GetMiddle</a>().c_str());
00209     m_last-&gt;SetValue(m_emp.<a class="code" href="class_yard_employee_type.html#a11">GetLast</a>().c_str());
00210     m_address-&gt;SetValue(m_emp.<a class="code" href="class_yard_employee_type.html#a13">GetAddress</a>().c_str());
00211     m_id-&gt;SetValue(m_emp.<a class="code" href="class_yard_employee_type.html#a4">GetIdS</a>().c_str());
00212     m_taxid-&gt;SetValue(m_emp.<a class="code" href="class_yard_employee_type.html#a7">GetTaxIdS</a>().c_str());
00213     m_phone-&gt;SetValue(m_emp.<a class="code" href="class_yard_employee_type.html#a17">GetPhone</a>().c_str());
00214     wxString pos;
00215     pos.Printf(wxT(<span class="stringliteral">"Title: %s"</span>), m_emp.<a class="code" href="class_yard_employee_type.html#a18">GetACL</a>().c_str());
00216     m_position-&gt;SetLabel(pos);
00217     pos.Printf(wxT(<span class="stringliteral">"Hire date: %s"</span>), m_emp.<a class="code" href="class_yard_employee_type.html#a22">GetSince</a>().c_str());
00218     m_hire-&gt;SetLabel(pos);
00219     m_loading = <span class="keyword">false</span>;
00220 }
00221 
<a name="l00222"></a><a class="code" href="class_yard_employee.html#a3">00222</a> <span class="keywordtype">void</span> <a class="code" href="class_yard_employee.html#a3">YardEmployee::OnNew</a>(wxCommandEvent&amp; event)
00223 {
00224     wxBitmap logo(<span class="stringliteral">"res/yast_sysadmin.png"</span>, wxBITMAP_TYPE_PNG);
00225     <a class="code" href="class_yard_new_employee.html">YardNewEmployee</a> * wizard = <span class="keyword">new</span> <a class="code" href="class_yard_new_employee.html">YardNewEmployee</a>(<span class="keyword">this</span>, -1, 
00226         wxT(<span class="stringliteral">"New Employee Wizard"</span>), logo);
00227     
00228     YardNewEmployee1 * page1 = <span class="keyword">new</span> YardNewEmployee1(wizard);
00229     YardNewEmployee2 * page2 = <span class="keyword">new</span> YardNewEmployee2(wizard);
00230     YardNewEmployee3 * page3 = <span class="keyword">new</span> YardNewEmployee3(wizard);
00231     
00232     wxWizardPageSimple::Chain(page1, page2);
00233     wxWizardPageSimple::Chain(page2, page3);
00234     
00235     wxSize min = page3-&gt;GetMin();
00236     wizard-&gt;SetPageSize(min);
00237 
00238     <span class="keywordflow">if</span> ( wizard-&gt;RunWizard(page1) )
00239     {
00240         wxLogDebug(wxT(<span class="stringliteral">"Wizard completed OK"</span>));
00241         
00242         <a class="code" href="class_yard_employee_type.html">YardEmployeeType</a> temp = wizard-&gt;<a class="code" href="class_yard_new_employee.html#a1">GetEmployee</a>();
00244         YardDate now(wxDateTime::Now());
00245         temp.<a class="code" href="class_yard_employee_type.html#a37">SetSince</a>(now);
00246         <span class="keywordflow">try</span> {
00247             wxGetApp().DB().EmployeeAdd(temp);
00248         }
00249         <span class="keywordflow">catch</span> (<a class="code" href="class_yard_d_b_exception.html">YardDBException</a>&amp; e)
00250         {
00251             wxLogDebug(wxT(<span class="stringliteral">"Error (employee not added): %s, %s"</span>),e.what(), e.GetSQL().c_str());
00252         }
00253     }
00254     wizard-&gt;Destroy();
00255     
00256 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun May 9 23:07:59 2004 for YardSale by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
